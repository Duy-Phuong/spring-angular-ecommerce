
- [eCommerce Project - Checkout Form - Drop-Down Lists](#ecommerce-project---checkout-form---drop-down-lists)
  - [Angular Project - Checkout Form - Populate Credit Card Dates - Overview](#angular-project---checkout-form---populate-credit-card-dates---overview)
  - [Angular Project - Checkout Form - Create Form Service](#angular-project---checkout-form---create-form-service)
  - [Angular Project -Checkout Form - Retrieve Months and Years from Service](#angular-project--checkout-form---retrieve-months-and-years-from-service)
  - [Angular Project - Checkout Form - Populate Drop-Down Lists for Months and Years](#angular-project---checkout-form---populate-drop-down-lists-for-months-and-years)
  - [Angular Project - Checkout Form - Dependent Fields - Overview](#angular-project---checkout-form---dependent-fields---overview)
  - [Angular Project - Checkout Form - Dependent Fields - Write Some Code](#angular-project---checkout-form---dependent-fields---write-some-code)
  - [Angular Project - Checkout Form - Populate Countries and States - Overview](#angular-project---checkout-form---populate-countries-and-states---overview)
  - [Angular Project - Checkout Form - Populate Countries and States - Create DB](#angular-project---checkout-form---populate-countries-and-states---create-db)
  - [Angular Project - Checkout Form - Populate Countries and States - JPA Entities](#angular-project---checkout-form---populate-countries-and-states---jpa-entities)
  - [Angular Project - Checkout Form - Populate Countries and States - Repositories](#angular-project---checkout-form---populate-countries-and-states---repositories)
  - [Angular Project - Checkout Form - Populate Countries and States - Repositories](#angular-project---checkout-form---populate-countries-and-states---repositories-1)
  - [Angular Project - Checkout Form - Populate Countries and States - REST Config](#angular-project---checkout-form---populate-countries-and-states---rest-config)
  - [Angular Project - Checkout Form - Populate Countries and States - Frontend](#angular-project---checkout-form---populate-countries-and-states---frontend)
  - [Angular Project - Checkout Form - Populate Countries and States - Create Classes](#angular-project---checkout-form---populate-countries-and-states---create-classes)
  - [Angular Project - Checkout Form - Populate Countries and States - Component](#angular-project---checkout-form---populate-countries-and-states---component)
  - [Angular Project - Checkout Form - Populate Countries and States - Event Handler](#angular-project---checkout-form---populate-countries-and-states---event-handler)
  - [Angular Project - Checkout Form - Populate Countries and States - States](#angular-project---checkout-form---populate-countries-and-states---states)
  - [Angular Project - Checkout Form - Populate Countries and States - Billing](#angular-project---checkout-form---populate-countries-and-states---billing)
  - [Angular Project - Checkout Form - Populate Countries and States - Console logs](#angular-project---checkout-form---populate-countries-and-states---console-logs)
  - [Angular Project - Checkout Form - Populate Countries and States - Bug Fix](#angular-project---checkout-form---populate-countries-and-states---bug-fix)
- [eCommerce Project - Checkout Form - Validation](#ecommerce-project---checkout-form---validation)
  - [Angular Project - Checkout Form - Validation Overview - Part 1](#angular-project---checkout-form---validation-overview---part-1)
  - [Angular Project - Checkout Form - Validation Overview - Part 2](#angular-project---checkout-form---validation-overview---part-2)
  - [Angular Project - Checkout Form - Add Validation Rules](#angular-project---checkout-form---add-validation-rules)
  - [Angular Project - Checkout Form - Display Validation Error Messages](#angular-project---checkout-form---display-validation-error-messages)
  - [Angular Project - Checkout Form - Display Validation Error Messages continued](#angular-project---checkout-form---display-validation-error-messages-continued)
  - [Angular Project - Checkout Form - Custom Validator Rule - Overview](#angular-project---checkout-form---custom-validator-rule---overview)
  - [Angular Project - Checkout Form - Custom Validator Rule - Define the Rule](#angular-project---checkout-form---custom-validator-rule---define-the-rule)
  - [Angular Project - Checkout Form - Custom Validator Rule - Apply the Rule](#angular-project---checkout-form---custom-validator-rule---apply-the-rule)
  - [Angular Project - Checkout Form - Shipping Validation - Part 2](#angular-project---checkout-form---shipping-validation---part-2)
  - [Angular Project - Checkout Form - Shipping Validation - Part 3](#angular-project---checkout-form---shipping-validation---part-3)
  - [Angular Project - Checkout Form - Billing Validation - Part 1](#angular-project---checkout-form---billing-validation---part-1)
  - [Angular Project - Checkout Form - Billing Validation - Part 2](#angular-project---checkout-form---billing-validation---part-2)
  - [Angular Project - Checkout Form - Billing Validation - Part 3](#angular-project---checkout-form---billing-validation---part-3)
  - [Angular Project - Checkout Form - Credit Card Validation - Part 1](#angular-project---checkout-form---credit-card-validation---part-1)
  - [Angular Project - Checkout Form - Credit Card Validation - Part 2](#angular-project---checkout-form---credit-card-validation---part-2)
  - [Angular Project - Checkout Form - Credit Card Validation - Part 3](#angular-project---checkout-form---credit-card-validation---part-3)
- [eCommerce Project - Checkout Form - Review Cart Totals](#ecommerce-project---checkout-form---review-cart-totals)
  - [Angular Project - Checkout Form - Review Cart Totals - Overview Part 1](#angular-project---checkout-form---review-cart-totals---overview-part-1)
  - [Angular Project - Checkout Form - Review Cart Totals - Overview Part 2](#angular-project---checkout-form---review-cart-totals---overview-part-2)
  - [Angular Project - Checkout Form - Review Cart Totals - Coding Part 1](#angular-project---checkout-form---review-cart-totals---coding-part-1)
- [eCommerce Project - Checkout Form - Save the Order to Database - Backend](#ecommerce-project---checkout-form---save-the-order-to-database---backend)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Overview](#ecommerce-project---checkout-form---save-the-order-to-database---overview)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Run DB Script](#ecommerce-project---checkout-form---save-the-order-to-database---run-db-script)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Entities - 1](#ecommerce-project---checkout-form---save-the-order-to-database---entities---1)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Entities - 2](#ecommerce-project---checkout-form---save-the-order-to-database---entities---2)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Entities - 3](#ecommerce-project---checkout-form---save-the-order-to-database---entities---3)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Entities - 4](#ecommerce-project---checkout-form---save-the-order-to-database---entities---4)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Create DTOs](#ecommerce-project---checkout-form---save-the-order-to-database---create-dtos)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Repo+Service 1](#ecommerce-project---checkout-form---save-the-order-to-database---reposervice-1)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Repo+Service 2](#ecommerce-project---checkout-form---save-the-order-to-database---reposervice-2)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Repo+Service 3](#ecommerce-project---checkout-form---save-the-order-to-database---reposervice-3)
  - [eCommerce Project - Checkout Form - Save the Order to Database - REST Controller](#ecommerce-project---checkout-form---save-the-order-to-database---rest-controller)
  - [eCommerce Project - Checkout Form - Save the Order to Database - Postman Test](#ecommerce-project---checkout-form---save-the-order-to-database---postman-test)
  - [Angular Project - Checkout Form - Review Cart Totals - Coding Part 2](#angular-project---checkout-form---review-cart-totals---coding-part-2)
- [eCommerce Project - Checkout Form - Save the Order to Database - Frontend](#ecommerce-project---checkout-form---save-the-order-to-database---frontend)
  - [eCommerce Project - Checkout Form - Save the Order - Frontend Overview](#ecommerce-project---checkout-form---save-the-order---frontend-overview)
  - [eCommerce Project - Checkout Form - Save the Order - Frontend - Common Classes](#ecommerce-project---checkout-form---save-the-order---frontend---common-classes)
  - [eCommerce Project - Checkout Form - Save the Order - Frontend - Checkout Service](#ecommerce-project---checkout-form---save-the-order---frontend---checkout-service)
  - [eCommerce Project - Checkout Form - Save the Order - Frontend - Injection](#ecommerce-project---checkout-form---save-the-order---frontend---injection)
  - [eCommerce Project - Checkout Form - Save the Order - Frontend - Order Items](#ecommerce-project---checkout-form---save-the-order---frontend---order-items)
  - [eCommerce Project - Checkout Form - Save the Order - Frontend - Purchase](#ecommerce-project---checkout-form---save-the-order---frontend---purchase)
  - [eCommerce Project - Checkout Form - Save the Order - Frontend - Call Service](#ecommerce-project---checkout-form---save-the-order---frontend---call-service)
  - [eCommerce Project - Checkout Form - Save the Order - Frontend - Test App](#ecommerce-project---checkout-form---save-the-order---frontend---test-app)
- [Release 3.0 - Security - Login/Logout](#release-30---security---loginlogout)
  - [Security - Login/Logout - Release 3 Tasks](#security---loginlogout---release-3-tasks)
  - [Security - Login/Logout - Security Concepts - Part 1](#security---loginlogout---security-concepts---part-1)
  - [Security - Login/Logout - Security Concepts - Part 2](#security---loginlogout---security-concepts---part-2)
  - [Security - Login/Logout - Okta Integration - Authorization Server](#security---loginlogout---okta-integration---authorization-server)
  - [Security - Login/Logout - Okta Integration - App Configuration](#security---loginlogout---okta-integration---app-configuration)
  - [Security - Login/Logout - Okta Integration - Sign-In Widget](#security---loginlogout---okta-integration---sign-in-widget)
  - [Security - Login/Logout - Okta Integration - Login Status Component](#security---loginlogout---okta-integration---login-status-component)
  - [Security - Login/Logout - Coding - Create OIDC Client App](#security---loginlogout---coding---create-oidc-client-app)
  - [Security - Login/Logout - Coding - Develop App Configuration](#security---loginlogout---coding---develop-app-configuration)
  - [Security - Login/Logout - Coding - Install Okta Dependencies](#security---loginlogout---coding---install-okta-dependencies)
  - [Security - Login/Logout - Coding - Create the Login Component](#security---loginlogout---coding---create-the-login-component)
  - [Security - Login/Logout - Coding - Render the Sign-In Widget](#security---loginlogout---coding---render-the-sign-in-widget)
  - [Security - Login/Logout - Coding - Develop Login Status Component](#security---loginlogout---coding---develop-login-status-component)
  - [Security - Login/Logout - Coding - Add CSS for Login Status Component](#security---loginlogout---coding---add-css-for-login-status-component)
  - [Security - Login/Logout - Coding - More CSS for Login Status Component](#security---loginlogout---coding---more-css-for-login-status-component)
  - [Security - Login/Logout - Coding - Connecting Routes](#security---loginlogout---coding---connecting-routes)
  - [Security - Login/Logout - Coding - App Module Configuration](#security---loginlogout---coding---app-module-configuration)
- [Release 3.0 - Security - VIP Member Access - Protected Routes](#release-30---security---vip-member-access---protected-routes)
  - [Release 3.0 - Security - VIP Member Access - Protected Routes - Overview](#release-30---security---vip-member-access---protected-routes---overview)
  - [Release . - Security - VIP Member Access - Protected Routes - Component Dev](#release----security---vip-member-access---protected-routes---component-dev)
  - [Release . - Security - VIP Member Access - Protected Routes - Configuration](#release----security---vip-member-access---protected-routes---configuration)
  - [Release . - Security - VIP Member Access - Protected Routes - Testing Access](#release----security---vip-member-access---protected-routes---testing-access)
- [Release 3.0 - Security - Handling Browser Refresh](#release-30---security---handling-browser-refresh)
  - [Release 3.0 - Security - Handling Browser Refresh - Overview Part 1](#release-30---security---handling-browser-refresh---overview-part-1)
  - [Release 3.0 - Security - Handling Browser Refresh - Overview Part 2](#release-30---security---handling-browser-refresh---overview-part-2)
  - [Release 3.0 - Security - Handling Browser Refresh - Loading and Persisting Items](#release-30---security---handling-browser-refresh---loading-and-persisting-items)
  - [Release 3.0 - Security - Handling Browser Refresh - Running the Application](#release-30---security---handling-browser-refresh---running-the-application)
  - [Release 3.0 - Security - Handling Browser Refresh - Exploring Storage in Browser](#release-30---security---handling-browser-refresh---exploring-storage-in-browser)
- [Release 3.0 - Refactoring](#release-30---refactoring)
  - [Release 3.0 - Refactoring - Handle Customer By Email - Overview](#release-30---refactoring---handle-customer-by-email---overview)
  - [Release 3.0 - Refactoring - Handle Customer By Email - Coding](#release-30---refactoring---handle-customer-by-email---coding)
  - [Release 3.0 - Refactoring - Handle Customer By Email - Run the App](#release-30---refactoring---handle-customer-by-email---run-the-app)
  - [Release 3.0 - Refactoring - Backend Configs - Overview - Part 1](#release-30---refactoring---backend-configs---overview---part-1)
  - [Release 3.0 - Refactoring - Backend Configs - Overview - Part 2](#release-30---refactoring---backend-configs---overview---part-2)
  - [Release 3.0 - Refactoring - Backend Configs - Coding - Fix Deprecated Method](#release-30---refactoring---backend-configs---coding---fix-deprecated-method)
  - [Release 3.0 - Refactoring - Backend Configs - Coding - Configure CORS Mapping](#release-30---refactoring---backend-configs---coding---configure-cors-mapping)
  - [Release 3.0 - Refactoring - Backend Configs - Coding - Configure @RestController](#release-30---refactoring---backend-configs---coding---configure-restcontroller)
  - [Release 3.0 - Refactoring - Backend Configs - Coding - Disable HTTP PATCH method](#release-30---refactoring---backend-configs---coding---disable-http-patch-method)
- [Release 3.0 - Security - Order History - Base Functionality](#release-30---security---order-history---base-functionality)
  - [Release 3.0 - Security - Order History - Backend Overview](#release-30---security---order-history---backend-overview)
  - [Release 3.0 - Security - Order History - Backend Coding](#release-30---security---order-history---backend-coding)
  - [Release 3.0 - Security - Order History - Frontend Overview](#release-30---security---order-history---frontend-overview)
  - [Release 3.0 - Security - Order History - Frontend Coding - Track User's Email](#release-30---security---order-history---frontend-coding---track-users-email)
  - [Release 3.0 - Security - Order History - Frontend Coding - OrderHistory Service](#release-30---security---order-history---frontend-coding---orderhistory-service)
  - [Release 3.0 - Security - Order History - Frontend Coding - OrderHistoryComponent](#release-30---security---order-history---frontend-coding---orderhistorycomponent)
  - [Release 3.0 - Security - Order History - Frontend Coding - Update HTML Page](#release-30---security---order-history---frontend-coding---update-html-page)
  - [Release 3.0 - Security - Order History - Frontend Coding - Add Orders Button](#release-30---security---order-history---frontend-coding---add-orders-button)
  - [Release 3.0 - Security - Order History - Frontend Coding - Run the App](#release-30---security---order-history---frontend-coding---run-the-app)
  - [Release 3.0 - Security - Order History - Frontend Coding - Sort Orders by Date](#release-30---security---order-history---frontend-coding---sort-orders-by-date)
- [Release 3.0 - Security - Order History - Secure Backend](#release-30---security---order-history---secure-backend)
  - [Release 3.0 - Security - Order History - Secure Backend Overview](#release-30---security---order-history---secure-backend-overview)
  - [Release 3.0 - Security - Order History - Secure Backend - Set Up Okta App](#release-30---security---order-history---secure-backend---set-up-okta-app)
  - [Release 3.0 - Security - Order History - Secure Backend - Configure Properties](#release-30---security---order-history---secure-backend---configure-properties)
  - [Release 3.0 - Security - Order History - Secure Backend - Protect Endpoints](#release-30---security---order-history---secure-backend---protect-endpoints)
  - [Release 3.0 - Security - Order History - Secure Backend - Testing the App](#release-30---security---order-history---secure-backend---testing-the-app)
- [Release 3.0 - Security - Order History - Secure Frontend](#release-30---security---order-history---secure-frontend)
  - [Release 3.0 - Security - Order History - Secure Frontend Overview - Part 1](#release-30---security---order-history---secure-frontend-overview---part-1)
  - [Release 3.0 - Security - Order History - Secure Frontend Overview - Part 2](#release-30---security---order-history---secure-frontend-overview---part-2)
  - [Release 3.0 - Security - Order History - Secure Frontend - Create an Interceptor](#release-30---security---order-history---secure-frontend---create-an-interceptor)
  - [Release 3.0 - Security - Order History - Secure Frontend - Pass Access Token](#release-30---security---order-history---secure-frontend---pass-access-token)
  - [Release 3.0 - Security - Order History - Secure Frontend - Register Interceptor](#release-30---security---order-history---secure-frontend---register-interceptor)
  - [Release 3.0 - Security - Order History - Secure Frontend - Test the App](#release-30---security---order-history---secure-frontend---test-the-app)
  - [Release 3.0 - Security - Order History - Secure Frontend - Resolve Checkout](#release-30---security---order-history---secure-frontend---resolve-checkout)
- [Secure Communication with HTTPS - Angular Frontend](#secure-communication-with-https---angular-frontend)
  - [Secure Communication with HTTPS - Angular Frontend - Overview](#secure-communication-with-https---angular-frontend---overview)
  - [Secure Communication with HTTPS - Angular Frontend - Coding Part 1](#secure-communication-with-https---angular-frontend---coding-part-1)
  - [Secure Communication with HTTPS - Angular Frontend - Coding Part 2](#secure-communication-with-https---angular-frontend---coding-part-2)
  - [Secure Communication with HTTPS - Okta Updates - Overview](#secure-communication-with-https---okta-updates---overview)
  - [Secure Communication with HTTPS - Okta Updates - Configuration](#secure-communication-with-https---okta-updates---configuration)
- [Secure Communication with HTTPS - Spring Boot Backend](#secure-communication-with-https---spring-boot-backend)
  - [Secure Communication with HTTPS - Spring Boot Backend - Overview](#secure-communication-with-https---spring-boot-backend---overview)
  - [Secure Communication with HTTPS - Spring Boot Backend - Coding Part 1](#secure-communication-with-https---spring-boot-backend---coding-part-1)
  - [Secure Communication with HTTPS - Spring Boot Backend - Coding Part 2](#secure-communication-with-https---spring-boot-backend---coding-part-2)
- [Angular Environment Configuration](#angular-environment-configuration)
  - [Angular Environment Configuration - Overview](#angular-environment-configuration---overview)
  - [Angular Environment Configuration - Coding](#angular-environment-configuration---coding)
  - [Angular Environment Configuration - Add New Environment - Overview Part 1](#angular-environment-configuration---add-new-environment---overview-part-1)
  - [Angular Environment Configuration - Add New Environment - Overview Part 2](#angular-environment-configuration---add-new-environment---overview-part-2)
  - [Angular Environment Configuration - Add New Environment - Overview Part 3](#angular-environment-configuration---add-new-environment---overview-part-3)
  - [Angular Environment Configuration - Add New Environment - Coding Part 1](#angular-environment-configuration---add-new-environment---coding-part-1)
  - [Angular Environment Configuration - Add New Environment - Coding Part 2](#angular-environment-configuration---add-new-environment---coding-part-2)
  - [Angular Environment Configuration - Add New Environment - Coding Part 3](#angular-environment-configuration---add-new-environment---coding-part-3)
- [Credit Card Payment Processing with Stripe](#credit-card-payment-processing-with-stripe)
  - [Credit Card Payment Processing Overview](#credit-card-payment-processing-overview)
  - [Payment Processing - Stripe API Overview](#payment-processing---stripe-api-overview)
  - [Payment Processing - Stripe Development Process Overview - Part 1](#payment-processing---stripe-development-process-overview---part-1)
  - [Payment Processing - Stripe Development Process Overview - Part 2](#payment-processing---stripe-development-process-overview---part-2)
  - [Payment Processing - Stripe - Backend Coding Setup - Maven](#payment-processing---stripe---backend-coding-setup---maven)
  - [Payment Processing - Stripe - Backend Coding Setup - API Keys](#payment-processing---stripe---backend-coding-setup---api-keys)
  - [Payment Processing - Stripe - Backend Coding - Checkout Service](#payment-processing---stripe---backend-coding---checkout-service)
  - [Payment Processing - Stripe - Backend Coding - Checkout Controller](#payment-processing---stripe---backend-coding---checkout-controller)
  - [Payment Processing - Stripe - Frontend Overview - Part 1](#payment-processing---stripe---frontend-overview---part-1)
  - [Payment Processing - Stripe - Frontend Overview - Part 2](#payment-processing---stripe---frontend-overview---part-2)
  - [Payment Processing - Stripe - Frontend Overview - Part 3](#payment-processing---stripe---frontend-overview---part-3)
  - [Payment Processing - Stripe - Frontend Coding - Part 1](#payment-processing---stripe---frontend-coding---part-1)
  - [Payment Processing - Stripe - Frontend Coding - Part 2](#payment-processing---stripe---frontend-coding---part-2)
  - [Payment Processing - Stripe - Frontend Coding - Part 3](#payment-processing---stripe---frontend-coding---part-3)
  - [Payment Processing - Stripe - Frontend Coding - Part 4](#payment-processing---stripe---frontend-coding---part-4)
  - [Payment Processing - Stripe - Frontend Coding - Part 5](#payment-processing---stripe---frontend-coding---part-5)
  - [Payment Processing - Stripe - Frontend Coding - Part 6](#payment-processing---stripe---frontend-coding---part-6)
  - [Payment Processing - Stripe - Frontend Coding - Part 7](#payment-processing---stripe---frontend-coding---part-7)
  - [Payment Processing - Stripe - Frontend Coding - Part 8](#payment-processing---stripe---frontend-coding---part-8)
  - [Payment Processing - Stripe - Bug Fix for Total Amount](#payment-processing---stripe---bug-fix-for-total-amount)
  - [Payment Processing - Stripe - Bug Fix for Browser Reload after Checkout](#payment-processing---stripe---bug-fix-for-browser-reload-after-checkout)
  - [Payment Processing - Stripe - Add Customer Details - Overview](#payment-processing---stripe---add-customer-details---overview)
  - [Payment Processing - Stripe - Add Customer Details - Coding Part 1](#payment-processing---stripe---add-customer-details---coding-part-1)
  - [Payment Processing - Stripe - Add Customer Details - Coding Part 2](#payment-processing---stripe---add-customer-details---coding-part-2)
  - [Payment Processing - Stripe - Disable Payment Button - Overview](#payment-processing---stripe---disable-payment-button---overview)
  - [Payment Processing - Stripe - Disable Payment Button - Coding](#payment-processing---stripe---disable-payment-button---coding)
  - [Payment Processing - Stripe - Email Receipts - Overview](#payment-processing---stripe---email-receipts---overview)
  - [Payment Processing - Stripe - Email Receipts - Coding Part 1](#payment-processing---stripe---email-receipts---coding-part-1)
  - [Payment Processing - Stripe - Email Receipts - Coding Part 2](#payment-processing---stripe---email-receipts---coding-part-2)


## eCommerce Project - Checkout Form - Drop-Down Lists

### Angular Project - Checkout Form - Populate Credit Card Dates - Overview
![](assets/Pasted%20image%2020220918005308.png)

ng generate service services/Luv2ShopForm




### Angular Project - Checkout Form - Create Form Service

### Angular Project -Checkout Form - Retrieve Months and Years from Service
https://github.com/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-2.0/18-checkout-form-populate-credit-card-dates-dropdown-list/03-frontend/angular-ecommerce/src/app/services/luv2-shop-form.service.ts

```ts
import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class Luv2ShopFormService {

  constructor() { }

  getCreditCardMonths(startMonth: number): Observable<number[]> {

    let data: number[] = [];
    
    // build an array for "Month" dropdown list
    // - start at current month and loop until 

    for (let theMonth = startMonth; theMonth <= 12; theMonth++) {
      data.push(theMonth);
    }

    return of(data);
  }

  getCreditCardYears(): Observable<number[]> {

    let data: number[] = [];

    // build an array for "Year" downlist list
    // - start at current year and loop for next 10 years
    
    const startYear: number = new Date().getFullYear();
    const endYear: number = startYear + 10;

    for (let theYear = startYear; theYear <= endYear; theYear++) {
      data.push(theYear);
    }

    return of(data);
  }

}
```

checkout.component.ts
```ts
// ngOnInit

// populate credit card months

const startMonth: number = new Date().getMonth() + 1;

console.log("startMonth: " + startMonth);

this.luv2ShopFormService.getCreditCardMonths(startMonth).subscribe(

data => {

console.log("Retrieved credit card months: " + JSON.stringify(data));

this.creditCardMonths = data;

}

);

// populate credit card years

this.luv2ShopFormService.getCreditCardYears().subscribe(

data => {

console.log("Retrieved credit card years: " + JSON.stringify(data));

this.creditCardYears = data;

}

);
```

checkout.component.html
```html
                    <div class="row">
                        <div class="col-md-2"> <label>Expiration Month</label></div>
                        <div class="col-md-9">
                            <div class="input-space">
                                <select formControlName="expirationMonth">
                                    <option *ngFor="let month of creditCardMonths">
                                        {{ month }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2"> <label>Expiration Year</label></div>
                        <div class="col-md-9">
                            <div class="input-space">
                                <select formControlName="expirationYear">
                                    <option *ngFor="let year of creditCardYears">
                                        {{ year }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
```

![](assets/Pasted%20image%2020220918010604.png)

### Angular Project - Checkout Form - Populate Drop-Down Lists for Months and Years

### Angular Project - Checkout Form - Dependent Fields - Overview
![](assets/Pasted%20image%2020220918010758.png)
![](assets/Pasted%20image%2020220918010816.png)

checkout.component.html
Add event

```java
                    <div class="row">
                        <div class="col-md-2"> <label>Expiration Year</label></div>
                        <div class="col-md-9">
                            <div class="input-space">
                                <select formControlName="expirationYear" (change)="handleMonthsAndYears()">
                                    <option *ngFor="let year of creditCardYears">
                                        {{ year }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
```

```typescript
  handleMonthsAndYears() {

    const creditCardFormGroup = this.checkoutFormGroup.get('creditCard');

    const currentYear: number = new Date().getFullYear();
    const selectedYear: number = Number(creditCardFormGroup.value.expirationYear);

    // if the current year equals the selected year, then start with the current month

    let startMonth: number;

    if (currentYear === selectedYear) {
      startMonth = new Date().getMonth() + 1;
    }
    else {
      startMonth = 1;
    }

    this.luv2ShopFormService.getCreditCardMonths(startMonth).subscribe(
      data => {
        console.log("Retrieved credit card months: " + JSON.stringify(data));
        this.creditCardMonths = data;
      }
    );
  }
```

### Angular Project - Checkout Form - Dependent Fields - Write Some Code

### Angular Project - Checkout Form - Populate Countries and States - Overview
![](assets/Pasted%20image%2020220918075743.png)
![](assets/Pasted%20image%2020220918011704.png)
![](assets/Pasted%20image%2020220918011724.png)

![](assets/Pasted%20image%2020220918011822.png)


### Angular Project - Checkout Form - Populate Countries and States - Create DB
https://github.com/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-2.0/20-checkout-form-populate-country-and-state-dropdown-list/01-starter-files/db-scripts/countries-and-states.sql
```sql
USE `full-stack-ecommerce`;

SET foreign_key_checks = 0;

--

-- Table structure for table `country`

--

USE `full-stack-ecommerce`;

SET foreign_key_checks = 0;

--
-- Table structure for table `country`
--

DROP TABLE IF EXISTS `country`;

CREATE TABLE `country` (
  `id` smallint unsigned NOT NULL,
  `code` varchar(2) DEFAULT NULL,
  `name` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

--
-- Data for table `country`
--

INSERT INTO `country` VALUES 
```

### Angular Project - Checkout Form - Populate Countries and States - JPA Entities

```java
package com.luv2code.ecommerce.entity;

import com.fasterxml.jackson.annotation.JsonIgnore;
import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;
import java.util.List;

@Entity
@Table(name="country")
@Getter
@Setter
public class Country {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name="id")
    private int id;

    @Column(name="code")
    private String code;

    @Column(name="name")
    private String name;

    @OneToMany(mappedBy = "country")
    @JsonIgnore
    private List<State> states;

}

```

```java
package com.luv2code.ecommerce.entity;

import lombok.Data;

import javax.persistence.*;

@Entity
@Table(name="state")
@Data
public class State {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name="id")
    private int id;

    @Column(name="name")
    private String name;

    @ManyToOne
    @JoinColumn(name="country_id")
    private Country country;

}
```

### Angular Project - Checkout Form - Populate Countries and States - Repositories

Add @JsonIgnore to entity

https://github.com/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-2.0/20-checkout-form-populate-country-and-state-dropdown-list/02-backend/spring-boot-ecommerce/src/main/java/com/luv2code/ecommerce/dao/CountryRepository.java

```java
package com.luv2code.ecommerce.dao;

import com.luv2code.ecommerce.entity.Country;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.rest.core.annotation.RepositoryRestResource;
import org.springframework.web.bind.annotation.CrossOrigin;

@CrossOrigin("http://localhost:4200")
@RepositoryRestResource(collectionResourceRel = "countries", path = "countries")
public interface CountryRepository extends JpaRepository<Country, Integer> {
}
```

### Angular Project - Checkout Form - Populate Countries and States - Repositories 
![](assets/Pasted%20image%2020220918080338.png)

### Angular Project - Checkout Form - Populate Countries and States - REST Config

```java
package com.luv2code.ecommerce.config;

import com.luv2code.ecommerce.entity.Country;
import com.luv2code.ecommerce.entity.Product;
import com.luv2code.ecommerce.entity.ProductCategory;
import com.luv2code.ecommerce.entity.State;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.rest.core.config.RepositoryRestConfiguration;
import org.springframework.data.rest.webmvc.config.RepositoryRestConfigurer;
import org.springframework.http.HttpMethod;

import javax.persistence.EntityManager;
import javax.persistence.metamodel.EntityType;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;

@Configuration
public class MyDataRestConfig implements RepositoryRestConfigurer {

    private EntityManager entityManager;

    @Autowired
    public MyDataRestConfig(EntityManager theEntityManager) {
        entityManager = theEntityManager;
    }


    @Override
    public void configureRepositoryRestConfiguration(RepositoryRestConfiguration config) {

        HttpMethod[] theUnsupportedActions = {HttpMethod.PUT, HttpMethod.POST, HttpMethod.DELETE};

        // disable HTTP methods for ProductCategory: PUT, POST and DELETE
        disableHttpMethods(Product.class, config, theUnsupportedActions);
        disableHttpMethods(ProductCategory.class, config, theUnsupportedActions);
        disableHttpMethods(Country.class, config, theUnsupportedActions);
        disableHttpMethods(State.class, config, theUnsupportedActions);

        // call an internal helper method
        exposeIds(config);
    }

    private void disableHttpMethods(Class theClass, RepositoryRestConfiguration config, HttpMethod[] theUnsupportedActions) {
        config.getExposureConfiguration()
                .forDomainType(theClass)
                .withItemExposure((metdata, httpMethods) -> httpMethods.disable(theUnsupportedActions))
                .withCollectionExposure((metdata, httpMethods) -> httpMethods.disable(theUnsupportedActions));
    }

    private void exposeIds(RepositoryRestConfiguration config) {

        // expose entity ids
        //

        // - get a list of all entity classes from the entity manager
        Set<EntityType<?>> entities = entityManager.getMetamodel().getEntities();

        // - create an array of the entity types
        List<Class> entityClasses = new ArrayList<>();

        // - get the entity types for the entities
        for (EntityType tempEntityType : entities) {
            entityClasses.add(tempEntityType.getJavaType());
        }

        // - expose the entity ids for the array of entity/domain types
        Class[] domainTypes = entityClasses.toArray(new Class[0]);
        config.exposeIdsFor(domainTypes);
    }
}
```

### Angular Project - Checkout Form - Populate Countries and States - Frontend
![](assets/Pasted%20image%2020220918082506.png)

### Angular Project - Checkout Form - Populate Countries and States - Create Classes

### Angular Project - Checkout Form - Populate Countries and States - Component
https://github.com/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-2.0/20-checkout-form-populate-country-and-state-dropdown-list/03-frontend/angular-ecommerce/src/app/services/luv2-shop-form.service.ts

```java
export class Luv2ShopFormService {

  private countriesUrl = 'http://localhost:8080/api/countries';
  private statesUrl = 'http://localhost:8080/api/states';

  constructor(private httpClient: HttpClient) { }

  getCountries(): Observable<Country[]> {

    return this.httpClient.get<GetResponseCountries>(this.countriesUrl).pipe(
      map(response => response._embedded.countries)
    );
  }

  getStates(theCountryCode: string): Observable<State[]> {

    // search url
    const searchStatesUrl = `${this.statesUrl}/search/findByCountryCode?code=${theCountryCode}`;

    return this.httpClient.get<GetResponseStates>(searchStatesUrl).pipe(
      map(response => response._embedded.states)
    );
  }
  
```

checkout.component.ts

```ts
// populate countries
// NgOnInit
    this.luv2ShopFormService.getCountries().subscribe(
      data => {
        console.log("Retrieved countries: " + JSON.stringify(data));
        this.countries = data;
      }
    );
  }

  getStates(formGroupName: string) {

    const formGroup = this.checkoutFormGroup.get(formGroupName);

    const countryCode = formGroup.value.country.code;
    const countryName = formGroup.value.country.name;

    console.log(`${formGroupName} country code: ${countryCode}`);
    console.log(`${formGroupName} country name: ${countryName}`);

    this.luv2ShopFormService.getStates(countryCode).subscribe(
      data => {

        if (formGroupName === 'shippingAddress') {
          this.shippingAddressStates = data; 
        }
        else {
          this.billingAddressStates = data;
        }

        // select first item by default
        formGroup.get('state').setValue(data[0]);
      }
    );
  }
```

checkout.component.html

```html
<!-- shipping Address -->
                <div formGroupName="shippingAddress" class="form-area">
                    <h3>Shipping Address</h3>

                    <div class="row">
                        <div class="col-md-2"> <label>Country</label></div>
                        <div class="col-md-9">
                            <div class="input-space">
                                <select formControlName="country" (change)="getStates('shippingAddress')">
                                    <option *ngFor="let country of countries" [ngValue]="country">
                                        {{ country.name }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>

                    ....

                    <div class="row">
                        <div class="col-md-2"> <label>State</label></div>
                        <div class="col-md-9">
                            <div class="input-space">
                                <select formControlName="state">
                                    <option *ngFor="let state of shippingAddressStates" [ngValue]="state">
                                        {{ state.name }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2"> <label>State</label></div>
                        <div class="col-md-9">
                            <div class="input-space">
                                <select formControlName="state">
                                    <option *ngFor="let state of billingAddressStates" [ngValue]="state">
                                        {{ state.name }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>

                </div>
```

event change

### Angular Project - Checkout Form - Populate Countries and States - Event Handler

### Angular Project - Checkout Form - Populate Countries and States - States

### Angular Project - Checkout Form - Populate Countries and States - Billing

### Angular Project - Checkout Form - Populate Countries and States - Console logs

checkout.component.ts
```typescript
onSubmit() {
    console.log("Handling the submit button");
    console.log(this.checkoutFormGroup.get('customer').value);
    console.log("The email address is " + this.checkoutFormGroup.get('customer').value.email);
  
    console.log("The shipping address country is " + this.checkoutFormGroup.get('shippingAddress').value.country.name);
    console.log("The shipping address state is " + this.checkoutFormGroup.get('shippingAddress').value.state.name);
  
  }
```

### Angular Project - Checkout Form - Populate Countries and States - Bug Fix
![](assets/Pasted%20image%2020220918084549.png)
check checkbox but state is not copied

```typescript
copyShippingAddressToBillingAddress(event) {

    if (event.target.checked) {
      this.checkoutFormGroup.controls.billingAddress
            .setValue(this.checkoutFormGroup.controls.shippingAddress.value);

      // bug fix for states
      this.billingAddressStates = this.shippingAddressStates;

    }
    else {
      this.checkoutFormGroup.controls.billingAddress.reset();

      // bug fix for states
      this.billingAddressStates = [];
    }
    
  }
```

## eCommerce Project - Checkout Form - Validation

### Angular Project - Checkout Form - Validation Overview - Part 1
![](assets/Pasted%20image%2020220918213531.png)



### Angular Project - Checkout Form - Validation Overview - Part 2
![](assets/Pasted%20image%2020220918214432.png)
![](assets/Pasted%20image%2020220918214512.png)
![](assets/Pasted%20image%2020220918214545.png)

![](assets/Pasted%20image%2020220918214726.png)
### Angular Project - Checkout Form - Add Validation Rules

checkout
![](assets/Pasted%20image%2020220918214805.png)
![](assets/Pasted%20image%2020220918214826.png)

```typescript
this.checkoutFormGroup = this.formBuilder.group({
      customer: this.formBuilder.group({
        firstName: new FormControl('', [Validators.required, Validators.minLength(2)]),
        lastName:  new FormControl('', [Validators.required, Validators.minLength(2)]),
        email: new FormControl('',
                              [Validators.required, Validators.pattern('^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$')])
      }),
```

### Angular Project - Checkout Form - Display Validation Error Messages

```typescript
<div class="row">
                        <div class="col-md-2"> <label>Last Name</label></div>
                        <div class="col-md-9">
                            <div class="input-space">
                                <input formControlName="lastName" type="text">

                                <div *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)" class="alert alert-danger mt-1">

                                    <div *ngIf="lastName.errors.required">
                                        Last Name is required
                                    </div>

                                    <div *ngIf="lastName.errors.minlength">
                                        Last Name must be at least 2 characters long
                                    </div>

                                </div>
                                
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2"> <label>Email</label></div>
                        <div class="col-md-9">
                            <div class="input-space">
                                <input formControlName="email" type="text">

                                <div *ngIf="email.invalid && (email.dirty || email.touched)" class="alert alert-danger mt-1">

                                    <div *ngIf="email.errors.required">
                                        Email is required
                                    </div>

                                    <div *ngIf="email.errors.pattern">
                                        Email must be a valid email address format
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>
```

### Angular Project - Checkout Form - Display Validation Error Messages continued

### Angular Project - Checkout Form - Custom Validator Rule - Overview
![](assets/Pasted%20image%2020220918215305.png)
![](assets/Pasted%20image%2020220918215332.png)
![](assets/Pasted%20image%2020220918215355.png)

### Angular Project - Checkout Form - Custom Validator Rule - Define the Rule

### Angular Project - Checkout Form - Custom Validator Rule - Apply the Rule

```typescript
shippingAddress: this.formBuilder.group({
        street: new FormControl('', [Validators.required, Validators.minLength(2), 
                                     Luv2ShopValidators.notOnlyWhitespace]),
        city: new FormControl('', [Validators.required, Validators.minLength(2), 
                                   Luv2ShopValidators.notOnlyWhitespace]),
        state: new FormControl('', [Validators.required]),
        country: new FormControl('', [Validators.required]),
        zipCode: new FormControl('', [Validators.required, Validators.minLength(2), 
                                      Luv2ShopValidators.notOnlyWhitespace])
      }),
      billingAddress: this.formBuilder.group({
        street: new FormControl('', [Validators.required, Validators.minLength(2), 
                                     Luv2ShopValidators.notOnlyWhitespace]),
        city: new FormControl('', [Validators.required, Validators.minLength(2), 
                                   Luv2ShopValidators.notOnlyWhitespace]),
        state: new FormControl('', [Validators.required]),
        country: new FormControl('', [Validators.required]),
        zipCode: new FormControl('', [Validators.required, Validators.minLength(2), 
                                      Luv2ShopValidators.notOnlyWhitespace])
      }),
      creditCard: this.formBuilder.group({
        cardType: new FormControl('', [Validators.required]),
        nameOnCard:  new FormControl('', [Validators.required, Validators.minLength(2), 
                                          Luv2ShopValidators.notOnlyWhitespace]),
        cardNumber: new FormControl('', [Validators.required, Validators.pattern('[0-9]{16}')]),
        securityCode: new FormControl('', [Validators.required, Validators.pattern('[0-9]{3}')]),
        expirationMonth: [''],
        expirationYear: ['']
      })

      ...

      get shippingAddressStreet() { return this.checkoutFormGroup.get('shippingAddress.street'); }
  get shippingAddressCity() { return this.checkoutFormGroup.get('shippingAddress.city'); }
  get shippingAddressState() { return this.checkoutFormGroup.get('shippingAddress.state'); }
  get shippingAddressZipCode() { return this.checkoutFormGroup.get('shippingAddress.zipCode'); }
  get shippingAddressCountry() { return this.checkoutFormGroup.get('shippingAddress.country'); }

  get billingAddressStreet() { return this.checkoutFormGroup.get('billingAddress.street'); }
  get billingAddressCity() { return this.checkoutFormGroup.get('billingAddress.city'); }
  get billingAddressState() { return this.checkoutFormGroup.get('billingAddress.state'); }
  get billingAddressZipCode() { return this.checkoutFormGroup.get('billingAddress.zipCode'); }
  get billingAddressCountry() { return this.checkoutFormGroup.get('billingAddress.country'); }

  get creditCardType() { return this.checkoutFormGroup.get('creditCard.cardType'); }
  get creditCardNameOnCard() { return this.checkoutFormGroup.get('creditCard.nameOnCard'); }
  get creditCardNumber() { return this.checkoutFormGroup.get('creditCard.cardNumber'); }
  get creditCardSecurityCode() { return this.checkoutFormGroup.get('creditCard.securityCode'); }
```

### Angular Project - Checkout Form - Shipping Validation - Part 2

### Angular Project - Checkout Form - Shipping Validation - Part 3

update html


### Angular Project - Checkout Form - Billing Validation - Part 1

### Angular Project - Checkout Form - Billing Validation - Part 2

### Angular Project - Checkout Form - Billing Validation - Part 3

### Angular Project - Checkout Form - Credit Card Validation - Part 1
![](assets/Pasted%20image%2020220918221607.png)

### Angular Project - Checkout Form - Credit Card Validation - Part 2

### Angular Project - Checkout Form - Credit Card Validation - Part 3

## eCommerce Project - Checkout Form - Review Cart Totals

### Angular Project - Checkout Form - Review Cart Totals - Overview Part 1
![](assets/Pasted%20image%2020220919105137.png)

![](assets/Pasted%20image%2020220918222254.png)
![](assets/Pasted%20image%2020220918222355.png)
![](assets/Pasted%20image%2020220918222441.png)
![](assets/Pasted%20image%2020220918222512.png)
![](assets/Pasted%20image%2020220918222553.png)
replaySubject

![](assets/Pasted%20image%2020220918222621.png)
![](assets/Pasted%20image%2020220918222658.png)
![](assets/Pasted%20image%2020220918222721.png)

### Angular Project - Checkout Form - Review Cart Totals - Overview Part 2

![](assets/Pasted%20image%2020220918223010.png)

![](assets/Pasted%20image%2020220918223054.png)
![](assets/Pasted%20image%2020220918223126.png)
![](assets/Pasted%20image%2020220918223151.png)

![](assets/Pasted%20image%2020220918223208.png)

### Angular Project - Checkout Form - Review Cart Totals - Coding Part 1
checkout

```typescript
ngOnInit(): void {
    
    this.reviewCartDetails(); // add

}

reviewCartDetails() {

    // subscribe to cartService.totalQuantity
    this.cartService.totalQuantity.subscribe(
      totalQuantity => this.totalQuantity = totalQuantity
    );

    // subscribe to cartService.totalPrice
    this.cartService.totalPrice.subscribe(
      totalPrice => this.totalPrice = totalPrice
    );

  }
```

```typescript
export class CartService {

  cartItems: CartItem[] = [];

  totalPrice: Subject<number> = new BehaviorSubject<number>(0);  // Update to BehaviorSubject
  totalQuantity: Subject<number> = new BehaviorSubject<number>(0);

  computeCartTotals() {

    let totalPriceValue: number = 0;
    let totalQuantityValue: number = 0;

    for (let currentCartItem of this.cartItems) {
      totalPriceValue += currentCartItem.quantity * currentCartItem.unitPrice;
      totalQuantityValue += currentCartItem.quantity;
    }

    // add
    // publish the new values ... all subscribers will receive the new data
    this.totalPrice.next(totalPriceValue);
    this.totalQuantity.next(totalQuantityValue);

    // log cart data just for debugging purposes
    this.logCartData(totalPriceValue, totalQuantityValue);
  }
```

## eCommerce Project - Checkout Form - Save the Order to Database - Backend

### eCommerce Project - Checkout Form - Save the Order to Database - Overview


![](assets/Pasted%20image%2020220919110503.png)

darbyluv2code/fullstack-angular-and-springboot/source-code/ecommerce-project-release-2.0/25-checkout-form-save-the-order-backend/01-starter-files/db-scripts/04-create-order-tables.sql

```sql
-- -----------------------------------------------------
-- Schema full-stack-ecommerce
-- -----------------------------------------------------

USE `full-stack-ecommerce`;

--
-- Prep work
--
SET FOREIGN_KEY_CHECKS=0;
DROP TABLE IF EXISTS `order_item`;
DROP TABLE IF EXISTS `orders`;
DROP TABLE IF EXISTS `customer`;
DROP TABLE IF EXISTS `address`;
SET FOREIGN_KEY_CHECKS=1;

--
-- Table structure for table `address`
--
CREATE TABLE `address` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `city` varchar(255) DEFAULT NULL,
  `country` varchar(255) DEFAULT NULL,
  `state` varchar(255) DEFAULT NULL,
  `street` varchar(255) DEFAULT NULL,
  `zip_code` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

--
-- Table structure for table `customer`
--
CREATE TABLE `customer` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `first_name` varchar(255) DEFAULT NULL,
  `last_name` varchar(255) DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

--
-- Table structure for table `orders`
--
CREATE TABLE `orders` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `order_tracking_number` varchar(255) DEFAULT NULL,
  `total_price` decimal(19,2) DEFAULT NULL,
  `total_quantity` int DEFAULT NULL,
  `billing_address_id` bigint DEFAULT NULL,
  `customer_id` bigint DEFAULT NULL,
  `shipping_address_id` bigint DEFAULT NULL,
  `status` varchar(128) DEFAULT NULL,
  `date_created` datetime(6) DEFAULT NULL,
  `last_updated` datetime(6) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK_billing_address_id` (`billing_address_id`),
  UNIQUE KEY `UK_shipping_address_id` (`shipping_address_id`),
  KEY `K_customer_id` (`customer_id`),
  CONSTRAINT `FK_customer_id` FOREIGN KEY (`customer_id`) REFERENCES `customer` (`id`),
  CONSTRAINT `FK_billing_address_id` FOREIGN KEY (`billing_address_id`) REFERENCES `address` (`id`),
  CONSTRAINT `FK_shipping_address_id` FOREIGN KEY (`shipping_address_id`) REFERENCES `address` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

--
-- Table structure for table `order_items`
--
CREATE TABLE `order_item` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `image_url` varchar(255) DEFAULT NULL,
  `quantity` int DEFAULT NULL,
  `unit_price` decimal(19,2) DEFAULT NULL,
  `order_id` bigint DEFAULT NULL,
  `product_id` bigint DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `K_order_id` (`order_id`),
  CONSTRAINT `FK_order_id` FOREIGN KEY (`order_id`) REFERENCES `orders` (`id`),
  CONSTRAINT `FK_product_id` FOREIGN KEY (`product_id`) REFERENCES `product` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

```

Development Process - Spring Boot
1.Run database script
2.Create entities
3.Create data transfer objects
4.Create repository
5.Create service
6.Create controller



### eCommerce Project - Checkout Form - Save the Order to Database - Run DB Script

### eCommerce Project - Checkout Form - Save the Order to Database - Entities - 1

```java
package com.luv2code.ecommerce.entity;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;
import java.util.HashSet;
import java.util.Set;

@Entity
@Table(name="customer")
@Getter
@Setter
public class Customer {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name="id")
    private Long id;

    @Column(name="first_name")
    private String firstName;

    @Column(name="last_name")
    private String lastName;

    @Column(name="email")
    private String email;

    @OneToMany(mappedBy = "customer", cascade = CascadeType.ALL)
    private Set<Order> orders = new HashSet<>();

    public void add(Order order) {

        if (order != null) {

            if (orders == null) {
                orders = new HashSet<>();
            }

            orders.add(order);
            order.setCustomer(this);
        }
    }

}

```

### eCommerce Project - Checkout Form - Save the Order to Database - Entities - 2

```java
package com.luv2code.ecommerce.entity;

import lombok.Getter;
import lombok.Setter;
import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;

import javax.persistence.*;
import java.math.BigDecimal;
import java.util.Date;
import java.util.HashSet;
import java.util.Set;

@Entity
@Table(name="orders")
@Getter
@Setter
public class Order {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name="id")
    private Long id;

    @Column(name="order_tracking_number")
    private String orderTrackingNumber;

    @Column(name="total_quantity")
    private int totalQuantity;

    @Column(name="total_price")
    private BigDecimal totalPrice;

    @Column(name="status")
    private String status;

    @Column(name="date_created")
    @CreationTimestamp
    private Date dateCreated;

    @Column(name="last_updated")
    @UpdateTimestamp
    private Date lastUpdated;

    @OneToMany(cascade = CascadeType.ALL, mappedBy = "order")
    private Set<OrderItem> orderItems = new HashSet<>();

    @ManyToOne
    @JoinColumn(name = "customer_id")
    private Customer customer;

    @OneToOne(cascade = CascadeType.ALL)
    @JoinColumn(name = "shipping_address_id", referencedColumnName = "id")
    private Address shippingAddress;

    @OneToOne(cascade = CascadeType.ALL)
    @JoinColumn(name = "billing_address_id", referencedColumnName = "id")
    private Address billingAddress;

    public void add(OrderItem item) {

        if (item != null) {
            if (orderItems == null) {
                orderItems = new HashSet<>();
            }

            orderItems.add(item);
            item.setOrder(this);
        }
    }
}
```

### eCommerce Project - Checkout Form - Save the Order to Database - Entities - 3

```java
package com.luv2code.ecommerce.entity;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;
import java.math.BigDecimal;

@Entity
@Table(name="order_item")
@Getter
@Setter
public class OrderItem {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name="id")
    private Long id;

    @Column(name="image_url")
    private String imageUrl;

    @Column(name="unit_price")
    private BigDecimal unitPrice;

    @Column(name="quantity")
    private int quantity;

    @Column(name="product_id")
    private Long productId;

    @ManyToOne
    @JoinColumn(name = "order_id")
    private Order order;

}

```

```java
package com.luv2code.ecommerce.entity;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;

@Entity
@Table(name="address")
@Getter
@Setter
public class Address {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name="id")
    private Long id;

    @Column(name="street")
    private String street;

    @Column(name="city")
    private String city;

    @Column(name="state")
    private String state;

    @Column(name="country")
    private String country;

    @Column(name="zip_code")
    private String zipCode;

    @OneToOne
    @PrimaryKeyJoinColumn
    private Order order;
}

```

### eCommerce Project - Checkout Form - Save the Order to Database - Entities - 4

### eCommerce Project - Checkout Form - Save the Order to Database - Create DTOs
create Purchase and PurchaseResponse

### eCommerce Project - Checkout Form - Save the Order to Database - Repo+Service 1

```java
package com.luv2code.ecommerce.dao;

import com.luv2code.ecommerce.entity.Customer;
import org.springframework.data.jpa.repository.JpaRepository;

public interface CustomerRepository extends JpaRepository<Customer, Long> {
}

```

```java
package com.luv2code.ecommerce.service;

import com.luv2code.ecommerce.dao.CustomerRepository;
import com.luv2code.ecommerce.dto.Purchase;
import com.luv2code.ecommerce.dto.PurchaseResponse;
import com.luv2code.ecommerce.entity.Customer;
import com.luv2code.ecommerce.entity.Order;
import com.luv2code.ecommerce.entity.OrderItem;
import org.springframework.stereotype.Service;

import javax.transaction.Transactional;
import java.util.Set;
import java.util.UUID;

@Service
public class CheckoutServiceImpl implements CheckoutService {

    private CustomerRepository customerRepository;

    public CheckoutServiceImpl(CustomerRepository customerRepository) {
        this.customerRepository = customerRepository;
    }

    @Override
    @Transactional
    public PurchaseResponse placeOrder(Purchase purchase) {

        // retrieve the order info from dto
        Order order = purchase.getOrder();

        // generate tracking number
        String orderTrackingNumber = generateOrderTrackingNumber();
        order.setOrderTrackingNumber(orderTrackingNumber);

        // populate order with orderItems
        Set<OrderItem> orderItems = purchase.getOrderItems();
        orderItems.forEach(item -> order.add(item));

        // populate order with billingAddress and shippingAddress
        order.setBillingAddress(purchase.getBillingAddress());
        order.setShippingAddress(purchase.getShippingAddress());

        // populate customer with order
        Customer customer = purchase.getCustomer();
        customer.add(order);

        // save to the database
        customerRepository.save(customer);

        // return a response
        return new PurchaseResponse(orderTrackingNumber);
    }

    private String generateOrderTrackingNumber() {

        // generate a random UUID number (UUID version-4)
        // For details see: https://en.wikipedia.org/wiki/Universally_unique_identifier
        //
        return UUID.randomUUID().toString();
    }
}
```

![](assets/Pasted%20image%2020220919122222.png)
![](assets/Pasted%20image%2020220919122243.png)

### eCommerce Project - Checkout Form - Save the Order to Database - Repo+Service 2

![](assets/Pasted%20image%2020220919122546.png)

### eCommerce Project - Checkout Form - Save the Order to Database - Repo+Service 3

### eCommerce Project - Checkout Form - Save the Order to Database - REST Controller

```java
package com.luv2code.ecommerce.controller;

import com.luv2code.ecommerce.dto.Purchase;
import com.luv2code.ecommerce.dto.PurchaseResponse;
import com.luv2code.ecommerce.service.CheckoutService;
import org.springframework.web.bind.annotation.*;

@CrossOrigin("http://localhost:4200")
@RestController
@RequestMapping("/api/checkout")
public class CheckoutController {

    private CheckoutService checkoutService;

    public CheckoutController(CheckoutService checkoutService) {
        this.checkoutService = checkoutService;
    }

    @PostMapping("/purchase")
    public PurchaseResponse placeOrder(@RequestBody Purchase purchase) {

        PurchaseResponse purchaseResponse = checkoutService.placeOrder(purchase);

        return purchaseResponse;
    }

}
```

### eCommerce Project - Checkout Form - Save the Order to Database - Postman Test

https://github.dev/darbyluv2code/fullstack-angular-and-springboot/blob/77976e046159ec20aefa09ffbf9018f42750b15e/source-code/ecommerce-project-release-2.0/25-checkout-form-save-the-order-backend/01-starter-files/sample-json/sample-purchase.json

```json
{
   "customer":{
      "firstName":"afasa",
      "lastName":"afasa",
      "email":"afasa@test.com"
   },
   "shippingAddress":{
      "street":"afasa",
      "city":"afasa",
      "state":"Alberta",
      "country":"Canada",
      "zipCode":"afasa"
   },
   "billingAddress":{
      "street":"fsfsf",
      "city":"sfdsf",
      "state":"Acre",
      "country":"Brazil",
      "zipCode":"19111"
   },
   "order":{
      "totalPrice":36.98,
      "totalQuantity":2
   },
   "orderItems":[
      {
         "imageUrl":"assets/images/products/coffeemugs/coffeemug-luv2code-1000.png",
         "quantity":1,
         "unitPrice":18.99,
         "productId":26
      },
      {
         "imageUrl":"assets/images/products/mousepads/mousepad-luv2code-1000.png",
         "quantity":1,
         "unitPrice":17.99,
         "productId":51
      }
   ]
}
```


### Angular Project - Checkout Form - Review Cart Totals - Coding Part 2
## eCommerce Project - Checkout Form - Save the Order to Database - Frontend


### eCommerce Project - Checkout Form - Save the Order - Frontend Overview
![](assets/Pasted%20image%2020220919154238.png)



### eCommerce Project - Checkout Form - Save the Order - Frontend - Common Classes

### eCommerce Project - Checkout Form - Save the Order - Frontend - Checkout Service

create new class

```typescript
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { Purchase } from '../common/purchase';

@Injectable({
  providedIn: 'root'
})
export class CheckoutService {

  private purchaseUrl = 'http://localhost:8080/api/checkout/purchase';

  constructor(private httpClient: HttpClient) { }

  placeOrder(purchase: Purchase): Observable<any> {
    return this.httpClient.post<Purchase>(this.purchaseUrl, purchase);    
  }
  
}

```

### eCommerce Project - Checkout Form - Save the Order - Frontend - Injection

```typescript
onSubmit() {
    console.log("Handling the submit button");

    if (this.checkoutFormGroup.invalid) {
      this.checkoutFormGroup.markAllAsTouched();
      return;
    }

    // set up order
    let order = new Order(this.totalQuantity, this.totalPrice);

    // get cart items
    const cartItems = this.cartService.cartItems;

    // create orderItems from cartItems
    // - long way
    /*
    let orderItems: OrderItem[] = [];
    for (let i=0; i < cartItems.length; i++) {
      orderItems[i] = new OrderItem(cartItems[i]);
    }
    */

    // - short way of doing the same thingy
    let orderItems: OrderItem[] = cartItems.map(tempCartItem => new OrderItem(tempCartItem.imageUrl!, tempCartItem.unitPrice!, tempCartItem.quantity, tempCartItem.id!));

    // set up purchase
    let purchase = new Purchase();
    
    // populate purchase - customer
    purchase.customer = this.checkoutFormGroup.controls['customer'].value;
    
    // populate purchase - shipping address
    purchase.shippingAddress = this.checkoutFormGroup.controls['shippingAddress'].value;
    const shippingState: State = JSON.parse(JSON.stringify(purchase.shippingAddress.state));
    const shippingCountry: Country = JSON.parse(JSON.stringify(purchase.shippingAddress.country));
    purchase.shippingAddress.state = shippingState.name;
    purchase.shippingAddress.country = shippingCountry.name;

    // populate purchase - billing address
    purchase.billingAddress = this.checkoutFormGroup.controls['billingAddress'].value;
    const billingState: State = JSON.parse(JSON.stringify(purchase.billingAddress.state));
    const billingCountry: Country = JSON.parse(JSON.stringify(purchase.billingAddress.country));
    purchase.billingAddress.state = billingState.name;
    purchase.billingAddress.country = billingCountry.name;
  
    // populate purchase - order and orderItems
    purchase.order = order;
    purchase.orderItems = orderItems;

    // call REST API via the CheckoutService
    this.checkoutService.placeOrder(purchase).subscribe({
        next: response => {
          alert(`Your order has been received.\nOrder tracking number: ${response.orderTrackingNumber}`);

          // reset cart
          this.resetCart();

        },
        error: err => {
          alert(`There was an error: ${err.message}`);
        }
      }
    );

  }

  resetCart() {
    // reset cart data
    this.cartService.cartItems = [];
    this.cartService.totalPrice.next(0);
    this.cartService.totalQuantity.next(0);
    
    // reset the form
    this.checkoutFormGroup.reset();

    // navigate back to the products page
    this.router.navigateByUrl("/products");
  }
```
### eCommerce Project - Checkout Form - Save the Order - Frontend - Order Items

### eCommerce Project - Checkout Form - Save the Order - Frontend - Purchase

### eCommerce Project - Checkout Form - Save the Order - Frontend - Call Service

### eCommerce Project - Checkout Form - Save the Order - Frontend - Test App

## Release 3.0 - Security - Login/Logout

### Security - Login/Logout - Release 3 Tasks

### Security - Login/Logout - Security Concepts - Part 1
![](assets/Pasted%20image%2020220919161123.png)
![](assets/Pasted%20image%2020220919161147.png)
![](assets/Pasted%20image%2020220919161202.png)
![](assets/Pasted%20image%2020220919161221.png)
![](assets/Pasted%20image%2020220919161236.png)
![](assets/Pasted%20image%2020220919161247.png)
![](assets/Pasted%20image%2020220919161302.png)
![](assets/Pasted%20image%2020220919161316.png)



### Security - Login/Logout - Security Concepts - Part 2
![](assets/Pasted%20image%2020220919162208.png)
![](assets/Pasted%20image%2020220919162250.png)



### Security - Login/Logout - Okta Integration - Authorization Server
![](assets/Pasted%20image%2020220919162753.png)
![](assets/Pasted%20image%2020220919162846.png)
![](assets/Pasted%20image%2020220919162916.png)
![](assets/Pasted%20image%2020220919162955.png)
![](assets/Pasted%20image%2020220919163445.png)
![](assets/Pasted%20image%2020220919163829.png)
![](assets/Pasted%20image%2020220919164029.png)

Once user login send to redirectUrl
![](assets/Pasted%20image%2020220919164056.png)
![](assets/Pasted%20image%2020220919164420.png)
 ![](assets/Pasted%20image%2020220919164456.png)
 ![](assets/Pasted%20image%2020220919164550.png)
 ![](assets/Pasted%20image%2020220919164634.png)

### Security - Login/Logout - Okta Integration - App Configuration


### Security - Login/Logout - Okta Integration - Sign-In Widget
![](assets/Pasted%20image%2020220919164705.png)
![](assets/Pasted%20image%2020220919164838.png)

![](assets/Pasted%20image%2020220919164942.png)
![](assets/Pasted%20image%2020220919165044.png)
![](assets/Pasted%20image%2020220919165139.png)




### Security - Login/Logout - Okta Integration - Login Status Component
![](assets/Pasted%20image%2020220919165250.png)

![](assets/Pasted%20image%2020220919165442.png)
![](assets/Pasted%20image%2020220919165500.png)


### Security - Login/Logout - Coding - Create OIDC Client App
Okta Sign-In Widget
https://github.com/okta/okta-signin-widget 
Okta Angular SDK
https://github.com/okta/okta-angular

sign up

![](assets/Pasted%20image%2020220919173123.png)

Click create and select OCID + single page application
![](assets/Pasted%20image%2020220919173210.png)

![](assets/Pasted%20image%2020220919173236.png)
![](assets/Pasted%20image%2020220919173326.png)
update app name
![](assets/Pasted%20image%2020220919173439.png)
![](assets/Pasted%20image%2020220919173509.png)
![](assets/Pasted%20image%2020220919173555.png)
save
![](assets/Pasted%20image%2020220919173629.png)
![](assets/Pasted%20image%2020220919173652.png)
![](assets/Pasted%20image%2020220919173717.png)



### Security - Login/Logout - Coding - Develop App Configuration

ng generate interface config/MyAppConfig

my-app-config.ts

```typescript
export default {

    oidc: {
        clientId: '<<UPDATE-WITH-YOUR-APP-CLIENT-ID>>',
        issuer: 'https://<<UPDATE-WITH-YOUR-DEV-DOMAIN>>/oauth2/default',
        redirectUri: 'http://localhost:4200/login/callback',
        scopes: ['openid', 'profile', 'email']
    }

}
```

![](assets/Pasted%20image%2020220919180121.png)
Finally
![](assets/Pasted%20image%2020220919180145.png)
![](assets/Pasted%20image%2020220919180232.png)
![](assets/Pasted%20image%2020220919180251.png)
![](assets/Pasted%20image%2020220919180441.png)
use the same version to install
![](assets/Pasted%20image%2020220919180607.png)
![](assets/Pasted%20image%2020220919180849.png)

Update angular.json

### Security - Login/Logout - Coding - Install Okta Dependencies

### Security - Login/Logout - Coding - Create the Login Component

https://github.dev/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-3.0/01-security-login-logout/03-frontend/angular-ecommerce/src/app/components/login/login.component.html

```ts
<!-- Container to inject the Okta Sign-In Widget -->

<div class="pt-5">

	<div id="okta-sign-in-widget" class="pt-5"></div>

</div>
```

![](assets/Pasted%20image%2020220919181412.png)
![](assets/Pasted%20image%2020220919181422.png)
https://angular.io/guide/typescript-configuration

https://github.dev/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-3.0/01-security-login-logout/03-frontend/angular-ecommerce/src/okta-signin-widget.d.ts#L1
```
declare module '@okta/okta-signin-widget';
```


```typescript
import { Component, Inject, OnInit } from '@angular/core';
import { OKTA_AUTH } from '@okta/okta-angular';
import { OktaAuth } from '@okta/okta-auth-js';
import OktaSignIn from '@okta/okta-signin-widget';

import myAppConfig from '../../config/my-app-config';

@Component({
  selector: 'app-login',
  templateUrl: './login.component.html',
  styleUrls: ['./login.component.css']
})
export class LoginComponent implements OnInit {

  oktaSignin: any;

  constructor(@Inject(OKTA_AUTH) private oktaAuth: OktaAuth) {

    this.oktaSignin = new OktaSignIn({
      logo: 'assets/images/logo.png',
      baseUrl: myAppConfig.oidc.issuer.split('/oauth2')[0],
      clientId: myAppConfig.oidc.clientId,
      redirectUri: myAppConfig.oidc.redirectUri,
      authParams: {
        pkce: true,
        issuer: myAppConfig.oidc.issuer,
        scopes: myAppConfig.oidc.scopes
      }
    });
   }

  ngOnInit(): void {
    this.oktaSignin.remove();

    this.oktaSignin.renderEl({
      el: '#okta-sign-in-widget'}, // this name should be same as div tag id in login.component.html
      (response: any) => {
        if (response.status === 'SUCCESS') {
          this.oktaAuth.signInWithRedirect();
        }
      },
      (error: any) => {
        throw error;
      }
    );
  }

}

```

### Security - Login/Logout - Coding - Render the Sign-In Widget

### Security - Login/Logout - Coding - Develop Login Status Component
https://github.dev/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-3.0/01-security-login-logout/03-frontend/angular-ecommerce/src/app/components/login-status/login-status.component.ts#L1

```typescript
import { Component, Inject, OnInit } from '@angular/core';
import { OktaAuthStateService, OKTA_AUTH } from '@okta/okta-angular';
import { OktaAuth } from '@okta/okta-auth-js';

@Component({
  selector: 'app-login-status',
  templateUrl: './login-status.component.html',
  styleUrls: ['./login-status.component.css']
})
export class LoginStatusComponent implements OnInit {

  isAuthenticated: boolean = false;
  userFullName: string = '';

  constructor(private oktaAuthService: OktaAuthStateService,
    @Inject(OKTA_AUTH) private oktaAuth: OktaAuth) { }

  ngOnInit(): void {

    // Subscribe to authentication state changes
    this.oktaAuthService.authState$.subscribe(
      (result) => {
        this.isAuthenticated = result.isAuthenticated!;
        this.getUserDetails();
      }
    );
  }
  
  getUserDetails() {
    if (this.isAuthenticated) {

      // Fetch the logged in user details (user's claims)
      //
      // user full name is exposed as a property name
      this.oktaAuth.getUser().then(
        (res) => {
          this.userFullName = res.name as string;
        }
      );
    }
  }

  logout() {
    // Terminates the session with Okta and removes current tokens.
    this.oktaAuth.signOut();
  }

}
```

```html
<div class="login-status-header">

    <div *ngIf="isAuthenticated && userFullName" class="login-status-user-info">
        Welcome back {{ userFullName }}!
    </div>

    <button *ngIf="!isAuthenticated" routerLink="/login" class="security-btn">Login</button>

    <button *ngIf="isAuthenticated" (click)="logout()" class="security-btn">Logout</button>

</div>
```

### Security - Login/Logout - Coding - Add CSS for Login Status Component
add css
https://github.dev/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-3.0/01-security-login-logout/03-frontend/angular-ecommerce/src/app/components/login-status/login-status.component.css#L1


### Security - Login/Logout - Coding - More CSS for Login Status Component
source-code/ecommerce-project-release-3.0/01-security-login-logout/03-frontend/angular-ecommerce/src/app/app.component.html
```
<div class="header-wrap">

  

<app-search></app-search>

<app-login-status></app-login-status>

<app-cart-status></app-cart-status>

  

</div>
```


### Security - Login/Logout - Coding - Connecting Routes
app.module

```typescript
import {
  OktaAuthModule,
  OktaCallbackComponent,
  OKTA_CONFIG 
} from '@okta/okta-angular';

import { OktaAuth } from '@okta/okta-auth-js';

import myAppConfig from './config/my-app-config';

const oktaConfig = myAppConfig.oidc;

const oktaAuth = new OktaAuth(oktaConfig);

const routes: Routes = [

  {path: 'login/callback', component: OktaCallbackComponent},
  {path: 'login', component: LoginComponent},
  
  ...

  imports: [
    RouterModule.forRoot(routes),
    BrowserModule,
    HttpClientModule,
    NgbModule,
    ReactiveFormsModule,
    OktaAuthModule // add
  ],
  providers: [ProductService, { provide: OKTA_CONFIG, useValue: { oktaAuth }}], // add
  bootstrap: [AppComponent]
})
export class AppModule { }

];
```

![](assets/Pasted%20image%2020220919182531.png)
![](assets/Pasted%20image%2020220919182714.png)
fix
source-code/ecommerce-project-release-3.0/01-security-login-logout/03-frontend/angular-ecommerce/angular.json

```typescript
"options": {
            "allowedCommonJsDependencies": [
              "lodash",
              "@babel/runtime-corejs3",
              "@okta/okta-signin-widget",
              "detect-node",
              "tiny-emitter",
              "p-cancelable",
              "cross-fetch"
            ],
            "outputPath": "dist/angular-ecommerce",
```


### Security - Login/Logout - Coding - App Module Configuration

## Release 3.0 - Security - VIP Member Access - Protected Routes

Check pdf for user registration section
![](assets/Pasted%20image%2020220919184701.png)

### Release 3.0 - Security - VIP Member Access - Protected Routes - Overview
![](assets/Pasted%20image%2020220919183423.png)
![](assets/Pasted%20image%2020220919183442.png)
![](assets/Pasted%20image%2020220919183508.png)
![](assets/Pasted%20image%2020220919183529.png)
![](assets/Pasted%20image%2020220919183614.png)

For additional details on Angular route guards, see this link    
www.luv2code.com/angular-route-guard
For details on OktaAuthGuard, see this link 
www.luv2code.com/okta-auth-guard

### Release . - Security - VIP Member Access - Protected Routes - Component Dev
create memberpage

login-status.component
```
<button *ngIf="isAuthenticated" routerLink="/members" class="security-btn ml-1">Member</button>
```

### Release . - Security - VIP Member Access - Protected Routes - Configuration
app.module

```typescript
function sendToLoginPage(oktaAuth: OktaAuth, injector: Injector) {
  // Use injector to access any service available within your application
  const router = injector.get(Router);

  // Redirect the user to your custom login page
  router.navigate(['/login']);
}

const routes: Routes = [
  {path: 'members', component: MembersPageComponent, canActivate: [OktaAuthGuard],
                    data: {onAuthRequired: sendToLoginPage} },
```

### Release . - Security - VIP Member Access - Protected Routes - Testing Access

## Release 3.0 - Security - Handling Browser Refresh

### Release 3.0 - Security - Handling Browser Refresh - Overview Part 1
We have a problem ...If we add products to the cart ...
Then refresh browser page ... we lose products in the car

![](assets/Pasted%20image%2020220919194923.png)

CartService

```typescript
storage: Storage = sessionStorage;
  // storage: Storage = localStorage;

  constructor() { 

    // read data from storage
    let data = JSON.parse(this.storage.getItem('cartItems')!);

    if (data != null) {
      this.cartItems = data;
      
      // compute totals based on the data that is read from storage
      this.computeCartTotals();
    }

  }

  persistCartItems() {
    this.storage.setItem('cartItems', JSON.stringify(this.cartItems));
  }
```


### Release 3.0 - Security - Handling Browser Refresh - Overview Part 2

### Release 3.0 - Security - Handling Browser Refresh - Loading and Persisting Items

### Release 3.0 - Security - Handling Browser Refresh - Running the Application

### Release 3.0 - Security - Handling Browser Refresh - Exploring Storage in Browser

## Release 3.0 - Refactoring

### Release 3.0 - Refactoring - Handle Customer By Email - Overview
![](assets/Pasted%20image%2020220919213126.png)
![](assets/Pasted%20image%2020220919213145.png)
![](assets/Pasted%20image%2020220919213322.png)
![](assets/Pasted%20image%2020220919213510.png)

### Release 3.0 - Refactoring - Handle Customer By Email - Coding

```java
package com.luv2code.ecommerce.dao;

import com.luv2code.ecommerce.entity.Customer;
import org.springframework.data.jpa.repository.JpaRepository;

public interface CustomerRepository extends JpaRepository<Customer, Long> {

    Customer findByEmail(String theEmail);

}

```

### Release 3.0 - Refactoring - Handle Customer By Email - Run the App

CheckoutServiceImpl
```java
// populate customer with order
        Customer customer = purchase.getCustomer();

        // check if this is an existing customer
        String theEmail = customer.getEmail();

        Customer customerFromDB = customerRepository.findByEmail(theEmail);

        if (customerFromDB != null) {
            // we found them ... let's assign them accordingly
            customer = customerFromDB;
        }

        customer.add(order);
```

### Release 3.0 - Refactoring - Backend Configs - Overview - Part 1
![](assets/Pasted%20image%2020220919214109.png)
![](assets/Pasted%20image%2020220919214243.png)
![](assets/Pasted%20image%2020220919214212.png)
![](assets/Pasted%20image%2020220919214323.png)
Remove @CorsOrigin



### Release 3.0 - Refactoring - Backend Configs - Overview - Part 2
![](assets/Pasted%20image%2020220919214534.png)
![](assets/Pasted%20image%2020220919214603.png)
![](assets/Pasted%20image%2020220919214658.png)
![](assets/Pasted%20image%2020220919214724.png)
![](assets/Pasted%20image%2020220919214740.png)


### Release 3.0 - Refactoring - Backend Configs - Coding - Fix Deprecated Method
https://github.dev/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-3.0/06-refactoring-backend-app-configs/02-backend/spring-boot-ecommerce/src/main/resources/application.properties#L1

```
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.datasource.url=jdbc:mysql://localhost:3306/full-stack-ecommerce?useSSL=false&useUnicode=yes&characterEncoding=UTF-8&allowPublicKeyRetrieval=true&serverTimezone=UTC

spring.datasource.username=ecommerceapp

spring.datasource.password=ecommerceapp

  

spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect

  

spring.data.rest.base-path=/api

  

allowed.origins=http://localhost:4200

  

spring.data.rest.detection-strategy=ANNOTATED
```


### Release 3.0 - Refactoring - Backend Configs - Coding - Configure CORS Mapping

MyDataRestConfig

```java
@Configuration
public class MyDataRestConfig implements RepositoryRestConfigurer {

    @Value("${allowed.origins}")
    private String[] theAllowedOrigins;

    private EntityManager entityManager;

    @Autowired
    public MyDataRestConfig(EntityManager theEntityManager) {
        entityManager = theEntityManager;
    }


    @Override
    public void configureRepositoryRestConfiguration(RepositoryRestConfiguration config, CorsRegistry cors) {

        HttpMethod[] theUnsupportedActions = {HttpMethod.PUT, HttpMethod.POST, HttpMethod.DELETE, HttpMethod.PATCH};

        // disable HTTP methods for ProductCategory: PUT, POST and DELETE
        disableHttpMethods(Product.class, config, theUnsupportedActions);
        disableHttpMethods(ProductCategory.class, config, theUnsupportedActions);
        disableHttpMethods(Country.class, config, theUnsupportedActions);
        disableHttpMethods(State.class, config, theUnsupportedActions);

        // call an internal helper method
        exposeIds(config);

        // configure cors mapping
        cors.addMapping(config.getBasePath() + "/**").allowedOrigins(theAllowedOrigins);
    }
```

### Release 3.0 - Refactoring - Backend Configs - Coding - Configure @RestController

```java
package com.luv2code.ecommerce.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class MyAppConfig implements WebMvcConfigurer {

    @Value("${allowed.origins}")
    private String[] theAllowedOrigins;

    @Value("${spring.data.rest.base-path}")
    private String basePath;

    @Override
    public void addCorsMappings(CorsRegistry cors) {

        // set up cors mapping
        cors.addMapping(basePath + "/**").allowedOrigins(theAllowedOrigins);
    }
}

```

![](assets/Pasted%20image%2020220919222949.png)

### Release 3.0 - Refactoring - Backend Configs - Coding - Disable HTTP PATCH method
## Release 3.0 - Security - Order History - Base Functionality

### Release 3.0 - Security - Order History - Backend Overview

### Release 3.0 - Security - Order History - Backend Coding
![](assets/Pasted%20image%2020220919223233.png)
![](assets/Pasted%20image%2020220919223304.png)

### Release 3.0 - Security - Order History - Frontend Overview
![](assets/Pasted%20image%2020220919223342.png)
![](assets/Pasted%20image%2020220919223834.png)


### Release 3.0 - Security - Order History - Frontend Coding - Track User's Email


### Release 3.0 - Security - Order History - Frontend Coding - OrderHistory Service
order-history.service
```typescript
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { OrderHistory } from '../common/order-history';

@Injectable({
  providedIn: 'root'
})
export class OrderHistoryService {

  private orderUrl = 'http://localhost:8080/api/orders';

  constructor(private httpClient: HttpClient) { }

  getOrderHistory(theEmail: string): Observable<GetResponseOrderHistory> {

    // need to build URL based on the customer email
    const orderHistoryUrl = `${this.orderUrl}/search/findByCustomerEmailOrderByDateCreatedDesc?email=${theEmail}`;

    return this.httpClient.get<GetResponseOrderHistory>(orderHistoryUrl);
  }
}

interface GetResponseOrderHistory {
  _embedded: {
    orders: OrderHistory[];
  }
}

```

### Release 3.0 - Security - Order History - Frontend Coding - OrderHistoryComponent

order-history.component

```typescript
import { Component, OnInit } from '@angular/core';
import { OrderHistory } from '../../common/order-history';
import { OrderHistoryService } from '../../services/order-history.service';

@Component({
  selector: 'app-order-history',
  templateUrl: './order-history.component.html',
  styleUrls: ['./order-history.component.css']
})
export class OrderHistoryComponent implements OnInit {

  orderHistoryList: OrderHistory[] = [];
  storage: Storage = sessionStorage;

  constructor(private orderHistoryService: OrderHistoryService) { }

  ngOnInit(): void {
    this.handleOrderHistory();
  }

  handleOrderHistory() {

    // read the user's email address from browser storage
    const theEmail = JSON.parse(this.storage.getItem('userEmail')!);

    // retrieve data from the service
    this.orderHistoryService.getOrderHistory(theEmail).subscribe(
      data => {
        this.orderHistoryList = data._embedded.orders;
      }
    );
  }

}

```

### Release 3.0 - Security - Order History - Frontend Coding - Update HTML Page

### Release 3.0 - Security - Order History - Frontend Coding - Add Orders Button

### Release 3.0 - Security - Order History - Frontend Coding - Run the App

app.module

```typescript
const routes: Routes = [
  {path: 'order-history', component: OrderHistoryComponent, canActivate: [OktaAuthGuard],
                    data: {onAuthRequired: sendToLoginPage} },
```

### Release 3.0 - Security - Order History - Frontend Coding - Sort Orders by Date

OrderRepository

```java
package com.luv2code.ecommerce.dao;

import com.luv2code.ecommerce.entity.Order;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.repository.query.Param;
import org.springframework.data.rest.core.annotation.RepositoryRestResource;

@RepositoryRestResource
public interface OrderRepository extends JpaRepository<Order, Long> {

    Page<Order> findByCustomerEmailOrderByDateCreatedDesc(@Param("email") String email, Pageable pageable);

}

```

![](assets/Pasted%20image%2020220919224430.png)

checkout.component
```typescript
ngOnInit(): void {
    
    this.reviewCartDetails();

    // read the user's email address from browser storage
    const theEmail = JSON.parse(this.storage.getItem('userEmail')!);

    this.checkoutFormGroup = this.formBuilder.group({
      customer: this.formBuilder.group({
        ...,
                               
        email: new FormControl(theEmail,
                              [Validators.required, Validators.pattern('^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$')])
      }),
```

## Release 3.0 - Security - Order History - Secure Backend

### Release 3.0 - Security - Order History - Secure Backend Overview
![](assets/Pasted%20image%2020220919230632.png)
![](assets/Pasted%20image%2020220919230719.png)
![](assets/Pasted%20image%2020220919230751.png)
https://github.com/okta/okta-spring-boot
![](assets/Pasted%20image%2020220919230853.png)
![](assets/Pasted%20image%2020220919230946.png)
![](assets/Pasted%20image%2020220919231036.png)
![](assets/Pasted%20image%2020220919231149.png)
![](assets/Pasted%20image%2020220919231307.png)



### Release 3.0 - Security - Order History - Secure Backend - Set Up Okta App

### Release 3.0 - Security - Order History - Secure Backend - Configure Properties

SecurityConfiguration

```java
package com.luv2code.ecommerce.config;

import com.okta.spring.boot.oauth.Okta;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
public class SecurityConfiguration extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {

        // protect endpoint /api/orders
        http.authorizeRequests()
                .antMatchers("/api/orders/**")
                .authenticated()
                .and()
                .oauth2ResourceServer()
                .jwt();

        // add CORS filters
        http.cors();

        // force a non-empty response body for 401's to make the response more friendly
        Okta.configureResourceServer401ResponseBody(http);

        // disable CSRF since we are not using Cookies for session tracking
        http.csrf().disable();
    }
}
```

### Release 3.0 - Security - Order History - Secure Backend - Protect Endpoints
![](assets/Pasted%20image%2020220919231702.png)
![](assets/Pasted%20image%2020220919231939.png)
![](assets/Pasted%20image%2020220919231811.png)
![](assets/Pasted%20image%2020220919231912.png)

### Release 3.0 - Security - Order History - Secure Backend - Testing the App

## Release 3.0 - Security - Order History - Secure Frontend
### Release 3.0 - Security - Order History - Secure Frontend Overview - Part 1
Development Process
1.Create an interceptor 
2.Update app.module.ts to reference interceptor


### Release 3.0 - Security - Order History - Secure Frontend Overview - Part 2
auth-interceptor.service

```typescript
import { HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { OktaAuthService } from '@okta/okta-angular';
import { from, Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class AuthInterceptorService implements HttpInterceptor {

  constructor(private oktaAuth: OktaAuthService) { }

  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    return from(this.handleAccess(request, next));
  }

  private async handleAccess(request: HttpRequest<any>, next: HttpHandler): Promise<HttpEvent<any>> { 

    // Only add an access token for secured endpoints
    const securedEndpoints = ['http://localhost:8080/api/orders'];

    if (securedEndpoints.some(url => request.urlWithParams.includes(url))) {

      // get access token
      const accessToken = await this.oktaAuth.getAccessToken();

      // clone the request and add new header with access token
      request = request.clone({
        setHeaders: {
          Authorization: 'Bearer ' + accessToken
        }
      });

    }

    return next.handle(request).toPromise();
  }
}

```

![](assets/Pasted%20image%2020220919233103.png)

clone since request is immutable

![](assets/Pasted%20image%2020220919233252.png)
![](assets/Pasted%20image%2020220919233409.png)

### Release 3.0 - Security - Order History - Secure Frontend - Create an Interceptor

### Release 3.0 - Security - Order History - Secure Frontend - Pass Access Token

### Release 3.0 - Security - Order History - Secure Frontend - Register Interceptor

### Release 3.0 - Security - Order History - Secure Frontend - Test the App

![](assets/Pasted%20image%2020220919233606.png)

### Release 3.0 - Security - Order History - Secure Frontend - Resolve Checkout
![](assets/Pasted%20image%2020220919233649.png)
![](assets/Pasted%20image%2020220919233835.png)
```
// disable CSRF since we are not using Cookies for session tracking

http.csrf().disable();
```


## Secure Communication with HTTPS - Angular Frontend

### Secure Communication with HTTPS - Angular Frontend - Overview
![](assets/Pasted%20image%2020220920002748.png)
![](assets/Pasted%20image%2020220920002824.png)
![](assets/Pasted%20image%2020220920002856.png)
![](assets/Pasted%20image%2020220920002925.png)
![](assets/Pasted%20image%2020220920003007.png)![](assets/Pasted%20image%2020220920003025.png)


### Secure Communication with HTTPS - Angular Frontend - Coding Part 1
www.luv2code.com/openssl-setup
view cert
```
$ openssl x509 -noout -text -in ssl-localhost/localhost.crt
```

Run npm start
![](assets/Pasted%20image%2020220920003647.png)
fix
update
```
allowed.origins=https://localhost:4200
```

### Secure Communication with HTTPS - Angular Frontend - Coding Part 2



### Secure Communication with HTTPS - Okta Updates - Overview
![](assets/Pasted%20image%2020220920003858.png)
![](assets/Pasted%20image%2020220920003916.png)
![](assets/Pasted%20image%2020220920003934.png)
SSO app
![](assets/Pasted%20image%2020220920004033.png)
![](assets/Pasted%20image%2020220920004207.png)
Trusted origin



### Secure Communication with HTTPS - Okta Updates - Configuration

## Secure Communication with HTTPS - Spring Boot Backend

### Secure Communication with HTTPS - Spring Boot Backend - Overview
![](assets/Pasted%20image%2020220920004354.png)
![](assets/Pasted%20image%2020220920004511.png)
![](assets/Pasted%20image%2020220920004609.png)

www.luv2code.com/java-keytool-docs

![](assets/Pasted%20image%2020220920004845.png)
![](assets/Pasted%20image%2020220920004929.png)


### Secure Communication with HTTPS - Spring Boot Backend - Coding Part 1
www.luv2code.com/keytool-steps


### Secure Communication with HTTPS - Spring Boot Backend - Coding Part 2

![](assets/Pasted%20image%2020220920010152.png)![](assets/Pasted%20image%2020220920010210.png)

## Angular Environment Configuration

### Angular Environment Configuration - Overview
![](assets/Pasted%20image%2020220920010555.png)
![](assets/Pasted%20image%2020220920010614.png)
![](assets/Pasted%20image%2020220920010648.png)


### Angular Environment Configuration - Coding
source-code/ecommerce-project-release-3.0/12-security-secure-communication-with-https-angular-environment-settings/03-frontend/angular-ecommerce/src/environments/environment.ts

```typescript
// This file can be replaced during build by using the `fileReplacements` array.
// `ng build --prod` replaces `environment.ts` with `environment.prod.ts`.
// The list of file replacements can be found in `angular.json`.

export const environment = {
  production: false,
  luv2shopApiUrl: "https://localhost:8443/api"
};

/*
 * For easier debugging in development mode, you can import the following file
 * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.
 *
 * This import should be commented out in production mode because it will have a negative impact
 * on performance if an error is thrown.
 */
// import 'zone.js/dist/zone-error';  // Included with Angular CLI.

```

Update all file with new env


### Angular Environment Configuration - Add New Environment - Overview Part 1
![](assets/Pasted%20image%2020220920011011.png)
![](assets/Pasted%20image%2020220920011046.png)

### Angular Environment Configuration - Add New Environment - Overview Part 2

https://github.dev/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-3.0/13-security-secure-communication-with-https-add-new-angular-environment-settings/03-frontend/angular-ecommerce/src/environments/environment.qa.ts#L1

angular.json

```json
"configurations": {
            "production": {
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.prod.ts"
                }
              ],
              ...
            },
            "qa": {
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.qa.ts"
                }
              ]
            }
```

![](assets/Pasted%20image%2020220920011418.png)
![](assets/Pasted%20image%2020220920011431.png)


### Angular Environment Configuration - Add New Environment - Overview Part 3
![](assets/Pasted%20image%2020220920011510.png)
![](assets/Pasted%20image%2020220920011544.png)

www.luv2code.com/angular-optimization-configuration

### Angular Environment Configuration - Add New Environment - Coding Part 1



### Angular Environment Configuration - Add New Environment - Coding Part 2

### Angular Environment Configuration - Add New Environment - Coding Part 3

## Credit Card Payment Processing with Stripe
### Credit Card Payment Processing Overview
![](assets/Pasted%20image%2020220920012502.png)
![](assets/Pasted%20image%2020220920012436.png)

### Payment Processing - Stripe API Overview
![](assets/Pasted%20image%2020220920012648.png)


![](assets/Pasted%20image%2020220920012744.png)
![](assets/Pasted%20image%2020220920012823.png)
![](assets/Pasted%20image%2020220920012941.png)

![](assets/Pasted%20image%2020220920013148.png)
![](assets/Pasted%20image%2020220920013359.png)
![](assets/Pasted%20image%2020220920013623.png)

### Payment Processing - Stripe Development Process Overview - Part 1
![](assets/Pasted%20image%2020220920013736.png)
![](assets/Pasted%20image%2020220920203830.png)
![](assets/Pasted%20image%2020220920203848.png)
![](assets/Pasted%20image%2020220920203902.png)


### Payment Processing - Stripe Development Process Overview - Part 2
![](assets/Pasted%20image%2020220920204022.png)
![](assets/Pasted%20image%2020220920204057.png)
![](assets/Pasted%20image%2020220920204127.png)
![](assets/Pasted%20image%2020220920204155.png)
![](assets/Pasted%20image%2020220920204234.png)

### Payment Processing - Stripe - Backend Coding Setup - Maven
https://stripe.com/
![](assets/Pasted%20image%2020220920205914.png)

https://stripe.com/docs/libraries
```xml
<!-- https://mvnrepository.com/artifact/com.stripe/stripe-java -->
		<dependency>
			<groupId>com.stripe</groupId>
			<artifactId>stripe-java</artifactId>
			<version>20.80.0</version>
		</dependency>
```


### Payment Processing - Stripe - Backend Coding Setup - API Keys

application
```
#

# Payment Processing with Stripe

#

#####

  

stripe.key.secret=sk_test_51IisA8EBpPFwN9NbvPisueypYm5T9L9VweRDZ2S0imegddCLxvIuGyx2x5gAy7i9VExGygwPRqO2WhsgibEHMsaj00NpUflm6v
```

![](assets/Pasted%20image%2020220920210600.png)

```java
package com.luv2code.ecommerce.dto;

import lombok.Data;

@Data
public class PaymentInfo {

    private int amount;
    private String currency;

}

```

![](assets/Pasted%20image%2020220920210846.png)
https://stripe.com/docs/payments/payment-intents

CheckoutService add new method

```java
    public CheckoutServiceImpl(CustomerRepository customerRepository,
                               @Value("${stripe.key.secret}") String secretKey) {

        this.customerRepository = customerRepository;

        // initialize Stripe API with secret key
        Stripe.apiKey = secretKey;
    }

    @Override
    public PaymentIntent createPaymentIntent(PaymentInfo paymentInfo) throws StripeException {

        List<String> paymentMethodTypes = new ArrayList<>();
        paymentMethodTypes.add("card");

        Map<String, Object> params = new HashMap<>();
        params.put("amount", paymentInfo.getAmount());
        params.put("currency", paymentInfo.getCurrency());
        params.put("payment_method_types", paymentMethodTypes);

        return PaymentIntent.create(params);
    }

```

### Payment Processing - Stripe - Backend Coding - Checkout Service

### Payment Processing - Stripe - Backend Coding - Checkout Controller

```java

@PostMapping("/payment-intent")
    public ResponseEntity<String> createPaymentIntent(@RequestBody PaymentInfo paymentInfo) throws StripeException {

        PaymentIntent paymentIntent = checkoutService.createPaymentIntent(paymentInfo);

        String paymentStr = paymentIntent.toJson();

        return new ResponseEntity<>(paymentStr, HttpStatus.OK);
    }
```

### Payment Processing - Stripe - Frontend Overview - Part 1
![](assets/Pasted%20image%2020220920211501.png)
![](assets/Pasted%20image%2020220920211516.png)
![](assets/Pasted%20image%2020220920211532.png)
![](assets/Pasted%20image%2020220920211552.png)
![](assets/Pasted%20image%2020220920211609.png)
![](assets/Pasted%20image%2020220920211626.png)
![](assets/Pasted%20image%2020220920211649.png)
![](assets/Pasted%20image%2020220920211709.png)
![](assets/Pasted%20image%2020220920211817.png)


### Payment Processing - Stripe - Frontend Overview - Part 2
![](assets/Pasted%20image%2020220920211905.png)
![](assets/Pasted%20image%2020220920211932.png)
![](assets/Pasted%20image%2020220920211955.png)

Step 7: Delete original form fields
![](assets/Pasted%20image%2020220920212109.png)
![](assets/Pasted%20image%2020220920212136.png)
![](assets/Pasted%20image%2020220920212940.png)

```typescript
setupStripePaymentForm() {

    // get a handle to stripe elements
    var elements = this.stripe.elements();

    // Create a card element ... and hide the zip-code field
    this.cardElement = elements.create('card', { hidePostalCode: true });

    // Add an instance of card UI component into the 'card-element' div
    this.cardElement.mount('#card-element');

    // Add event binding for the 'change' event on the card element
    this.cardElement.on('change', (event) => {

      // get a handle to card-errors element
      this.displayError = document.getElementById('card-errors');

      if (event.complete) {
        this.displayError.textContent = "";
      } else if (event.error) {
        // show validation error to customer
        this.displayError.textContent = event.error.message;
      }

    });

  }
```

### Payment Processing - Stripe - Frontend Overview - Part 3
![](assets/Pasted%20image%2020220920213210.png)

![](assets/Pasted%20image%2020220920213305.png)

checkout.component

OnSubmit function

```typescript
// compute payment info
    this.paymentInfo.amount = this.totalPrice * 100;
    this.paymentInfo.currency = "USD";

    // if valid form then
    // - create payment intent
    // - confirm card payment
    // - place order

    if (!this.checkoutFormGroup.invalid && this.displayError.textContent === "") {

      this.checkoutService.createPaymentIntent(this.paymentInfo).subscribe(
        (paymentIntentResponse) => {
          this.stripe.confirmCardPayment(paymentIntentResponse.client_secret,
            {
              payment_method: {
                card: this.cardElement
              }
            }, { handleActions: false })
          .then(function(result) {
            if (result.error) {
              // inform the customer there was an error
              alert(`There was an error: ${result.error.message}`);
            } else {
              // call REST API via the CheckoutService
              this.checkoutService.placeOrder(purchase).subscribe({
                next: response => {
                  alert(`Your order has been received.\nOrder tracking number: ${response.orderTrackingNumber}`);

                  // reset cart
                  this.resetCart();
                },
                error: err => {
                  alert(`There was an error: ${err.message}`);
                }
              })
            }            
          }.bind(this));
        }
      );
    } else {
      this.checkoutFormGroup.markAllAsTouched();
      return;
    }

  }
```

![](assets/Pasted%20image%2020220920213847.png)

![](assets/Pasted%20image%2020220920213953.png)
https://stripe.com/docs/testing


### Payment Processing - Stripe - Frontend Coding - Part 1

typings.d.ts

```typescript
declare var Stripe: any;
declare var elements: any;
```

Provides type information
for Javascript libraries
![](assets/Pasted%20image%2020220920215421.png)
update environment

https://github.dev/darbyluv2code/fullstack-angular-and-springboot/blob/master/source-code/ecommerce-project-release-3.0/14-payment-processing-with-stripe/03-frontend/angular-ecommerce/src/app/common/payment-info.ts#L1

```typescript
export class PaymentInfo {
    amount: number;
    currency: string;
}

```

### Payment Processing - Stripe - Frontend Coding - Part 2

checkout.service
```typescript
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { environment } from 'src/environments/environment';
import { Purchase } from '../common/purchase';
import { PaymentInfo } from '../common/payment-info';

@Injectable({
  providedIn: 'root'
})
export class CheckoutService {

  private purchaseUrl = environment.luv2shopApiUrl + '/checkout/purchase';

  private paymentIntentUrl = environment.luv2shopApiUrl + '/checkout/payment-intent';
  
  constructor(private httpClient: HttpClient) { }

  ...

  createPaymentIntent(paymentInfo: PaymentInfo): Observable<any> {
    return this.httpClient.post<PaymentInfo>(this.paymentIntentUrl, paymentInfo);
  }
  
}

```

index.html

```typescript
  <script src="https://js.stripe.com/v3" async></script>

```

### Payment Processing - Stripe - Frontend Coding - Part 3

delete creditCard

checkout.component

```typescript
 <!-- Stripe Elements Credit Card Section -->
                <div formGroupName="creditCard" class="form-area">

                    <h3>Credit or Debit Card</h3>

                    <div id="card-element">
                        <!-- a Stripe element will be inserted here -->
                    </div>

                    <!-- Used to display form errors -->
                    <div id="card-errors" class="displayError.textContent!=='': 'alert alert-danger mt-1'"></div>

                </div>
```

### Payment Processing - Stripe - Frontend Coding - Part 4

```typescript
// initialize Stripe API
  stripe = Stripe(environment.stripePublishableKey);

  paymentInfo: PaymentInfo = new PaymentInfo();
  cardElement: any;
  displayError: any = "";

  constructor(private formBuilder: FormBuilder,
              private luv2ShopFormService: Luv2ShopFormService,
              private cartService: CartService,
              private checkoutService: CheckoutService,
              private router: Router) { }

  ngOnInit(): void {

    // setup Stripe payment form
    this.setupStripePaymentForm();
    
    this.reviewCartDetails();

    // read the user's email address from browser storage
    const theEmail = JSON.parse(this.storage.getItem('userEmail'));

    this.checkoutFormGroup = this.formBuilder.group({
      customer: this.formBuilder.group({
        ....

      creditCard: this.formBuilder.group({
        /*
        cardType: new FormControl('', [Validators.required]),
        nameOnCard:  new FormControl('', [Validators.required, Validators.minLength(2), 
                                          Luv2ShopValidators.notOnlyWhitespace]),
        cardNumber: new FormControl('', [Validators.required, Validators.pattern('[0-9]{16}')]),
        securityCode: new FormControl('', [Validators.required, Validators.pattern('[0-9]{3}')]),
        expirationMonth: [''],
        expirationYear: ['']
        */
      })
    });

    /*
    // populate credit card months

    const startMonth: number = new Date().getMonth() + 1;
    console.log("startMonth: " + startMonth);

    this.luv2ShopFormService.getCreditCardMonths(startMonth).subscribe(
      data => {
        console.log("Retrieved credit card months: " + JSON.stringify(data));
        this.creditCardMonths = data;
      }
    );

    // populate credit card years

    this.luv2ShopFormService.getCreditCardYears().subscribe(
      data => {
        console.log("Retrieved credit card years: " + JSON.stringify(data));
        this.creditCardYears = data;
      }
    );
    */

   setupStripePaymentForm() {

    // get a handle to stripe elements
    var elements = this.stripe.elements();

    // Create a card element ... and hide the zip-code field
    this.cardElement = elements.create('card', { hidePostalCode: true });

    // Add an instance of card UI component into the 'card-element' div
    this.cardElement.mount('#card-element');

    // Add event binding for the 'change' event on the card element
    this.cardElement.on('change', (event) => {

      // get a handle to card-errors element
      this.displayError = document.getElementById('card-errors');

      if (event.complete) {
        this.displayError.textContent = "";
      } else if (event.error) {
        // show validation error to customer
        this.displayError.textContent = event.error.message;
      }

    });

  }
```

### Payment Processing - Stripe - Frontend Coding - Part 5

### Payment Processing - Stripe - Frontend Coding - Part 6
Handle onSubmit method

### Payment Processing - Stripe - Frontend Coding - Part 7

https://stripe.com/docs/testing

![](assets/Pasted%20image%2020220920221004.png)
![](assets/Pasted%20image%2020220920221025.png)


### Payment Processing - Stripe - Frontend Coding - Part 8

### Payment Processing - Stripe - Bug Fix for Total Amount
![](assets/Pasted%20image%2020220920221112.png)

log in UI and backend
![](assets/Pasted%20image%2020220920221345.png)
In backend:  1898

![](assets/Pasted%20image%2020220920221445.png)
![](assets/Pasted%20image%2020220920221502.png)
![](assets/Pasted%20image%2020220920221533.png)
![](assets/Pasted%20image%2020220920221553.png)


### Payment Processing - Stripe - Bug Fix for Browser Reload after Checkout
![](assets/Pasted%20image%2020220920221719.png)
![](assets/Pasted%20image%2020220920221812.png)
![](assets/Pasted%20image%2020220920221831.png)
![](assets/Pasted%20image%2020220920222006.png)




### Payment Processing - Stripe - Add Customer Details - Overview
![](assets/Pasted%20image%2020220920222123.png)
![](assets/Pasted%20image%2020220920222142.png)
![](assets/Pasted%20image%2020220920222301.png)


### Payment Processing - Stripe - Add Customer Details - Coding Part 1

### Payment Processing - Stripe - Add Customer Details - Coding Part 2
![](assets/Pasted%20image%2020220920222333.png)

CheckoutServiceImpl
```java
@Override
    public PaymentIntent createPaymentIntent(PaymentInfo paymentInfo) throws StripeException {

        List<String> paymentMethodTypes = new ArrayList<>();
        paymentMethodTypes.add("card");

        Map<String, Object> params = new HashMap<>();
        params.put("amount", paymentInfo.getAmount());
        params.put("currency", paymentInfo.getCurrency());
        params.put("payment_method_types", paymentMethodTypes);
        params.put("description", "Luv2Shop purchase"); // add

        return PaymentIntent.create(params);
    }
```


### Payment Processing - Stripe - Disable Payment Button - Overview
![](assets/Pasted%20image%2020220920222557.png)
![](assets/Pasted%20image%2020220920222617.png)
![](assets/Pasted%20image%2020220920222643.png)


### Payment Processing - Stripe - Disable Payment Button - Coding

### Payment Processing - Stripe - Email Receipts - Overview
![](assets/Pasted%20image%2020220920222835.png)
![](assets/Pasted%20image%2020220920222851.png)
![](assets/Pasted%20image%2020220920222940.png)
![](assets/Pasted%20image%2020220920223002.png)


### Payment Processing - Stripe - Email Receipts - Coding Part 1

### Payment Processing - Stripe - Email Receipts - Coding Part 2
![](assets/Pasted%20image%2020220920223102.png)
![](assets/Pasted%20image%2020220920223120.png)

![](assets/Pasted%20image%2020220920223146.png)

